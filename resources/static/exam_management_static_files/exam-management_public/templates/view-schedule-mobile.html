
<!-- Main content -->
   <div class="content">
     <div class="container-fluid">
       <div class="row">          
         <!-- /.col-md-12 -->
         <div class="col-lg-12"> 
           <div class="card card-info card-outline">
             <div class="card-header">
               <h5 class="m-0"> Edit / View Schedule </h5>
             </div>
             <div class="card-body">
             <div class="row">
	             <div class="col-md-4">
							<div class="form-group">
							   <label for="program">Program</label>
							   <select class="form-control" id="selectProgram" name="program" required>
									<option>Select Program</option>	
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
							   <label for="batch">Batch</label>
							   <select class="form-control" id="selectBatch" name="batch" required>
									  <option>Select Batch</option>							  
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
							   <label for="semester">Semester</label>
							   <select class="form-control" id="selectSemester" name="semester" required>
									   <option>Select Semester</option>
								</select>
							</div>
						</div>	
				</div>
				    </div>
         <!-- /.col-md-12 -->
       </div>
       <!-- /.row -->
     </div><!-- /.container-fluid -->
   </div>
   
   <!-- /.main content -->
                   <div class="card" id="divSchedules" style="display:none;">
				
					<div class="table-responsive">
					  <table id="tblExamSchedule" class="table table table-striped table-bordered  display" style="width:100%">
						<thead>
							<tr>
								
							  <th>Academic Year </th>
							  <th>Exam Name</th>
							  <th>Month Year</th>
							 <!--  <th>Status</th> -->
							  <th>Approval Status </th>
							  <th>View</th>
							  <th>Edit</th>
							 
							 
							</tr>
							</thead>
					  </table>				  
					 
					</div>
					<!-- /.table-responsive -->
				</div>	
					
				
					<!-- /.table-responsive -->
				 
				</div>
				
				 
				</div>		
					
		
			    
			<!-- /Preview Schedule -->
			
			<div  id="divViewSchedules" style="display:none;">
			<div class="row" >
			<div class="col-lg-12">
			<div class="invoice p-3 mb-3">
			<div class="tab-content">
			<div class="post">
			<div class="user-block text-center">
			<img class="img-circle img-bordered-sm" src="exam-management_proxy/exam-management_public/img/nuals.jpg" alt="user image" style="width:70px;height:70px;">
			<span class="username text-center">
			<h3>The National University of Advanced Legal Studies</h3>
			</span>
			<h6 id="applnType" style="font-weight:600">Exam Schedule</h6>
			<hr/>
			</div>
			</div>
			</div>
			
			<div class="row mb-4">
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Academic Year : <br/><code id="academicYear">2005-2010</code></h5>
			</div>
			</div>
			
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Programme  : <br/><code id="program">LLB </code></h5>
			</div>
			</div>
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Batch / Semester : <br/><code id="batch_sem">2005/Semester9</code></h5>
			</div>
			</div>
			
			<div class="col-md-3">
			<div class="description-block">
			<h5 class="description-header">Exam Type : <br/><code id="exam_type">Supplmentary</code></h5>
			</div>
			</div>
			</div>
			<hr>
			<dl class="row pl-5 ml-3">
			<dt class="col-sm-4 description-header" >Name of the Exam : </dt>
			<dd class="col-sm-8" id="exam_name"> 2014-2019 Master of Law</dd>
			<dt class="col-sm-4">Month and Year :</dt>
			<dd class="col-sm-8" id="month_year">March 2020</dd>
			<dt class="col-sm-4">Tentative date of Exam:</dt>
			<dd class="col-sm-8" id="tentative_date">12-01-2020</dd>
			<dt class="col-sm-4">Last Date of payment without fine:</dt>
			<dd class="col-sm-8" id="date_without_fine">12-12-2019</dd>
			<dt class="col-sm-4">Last Date of payment with fine:</dt>
			<dd class="col-sm-8" id="date_with_fine">23-12-2019</dd>
			<dt class="col-sm-4">Instructions:</dt>
			<dd class="col-sm-8" id="instructions">Testing </dd>
			<dt class="col-sm-4"> Fee Structure:</dt>
			<dd class="col-sm-8" id="">
			     <div class="table-responsive">
					<table class="table" id="displayTable">					
						</table>
					</div>
			</dd>
			</dl>
				
			<div class="row">
			<div class="col-md-12">
			<div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Timetable</div>
			<table class="table table-bordered m-0" id="tblTimetable">
			<thead>
			<tr>
			<th>Date </th>
			<th>Day</th>
			<th>Course Id</th>
			<th>Course Name</th>
			<th>Start and End Time</th>
			</tr>
			</thead>
			</table>
			</div>
			</div>
			</div>
			</div>
			</div>
			</div>
			<!-- Preview Schedule-->
				 
   
   <!-- Main content -->
    <div class="content" id="collapseEditSchedule" style="display:none;">
    <form id="formExamSchedule" >
      <div class="container-fluid">
        <div class="row">          
          <!-- /.col-md-12 -->
          <div class="col-lg-12">           

            <div class="card card-info card-outline">
              <div class="card-header ">
                <h5 class="m-0 card-title">Exam Schedule</h5>
				
              </div>
              <div class="card-body ">
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
						   <label for="academic Year">Academic Year</label>
						    <select class="form-control" id="selectAcademicYearEdit" name="academic_year" required>
								  <option>Select Academic Year</option>
							</select>
							<!-- <p id="divAcademicYear"></p> -->
						</div>
					</div>	
					<div class="col-md-3">
						<div class="form-group">
						   <label for="program">Program</label>
						    <select class="form-control" id="selectProgramEdit" name="program" required>
								<option>Select Program</option>	
							</select>
							<!-- <p id="divProgram"></p> -->
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="batch">Batch</label>
						  <select class="form-control" id="selectBatchEdit" name="batch" required>
								  <option>Select Batch</option>							  
							</select><!--  <p id="divBatch"></p> -->
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="semester">Semester</label>
						   <select class="form-control" id="selectSemesterEdit" name="semester" required>
								   <option>Select Semester</option>
							</select> 
							<!-- <p id="divSemester"></p> -->
						</div>
					</div>	
				
				
				
				
					</div>
					<div class="row">
						<div class="col-md-3">
						<div class="form-group">
						   <label for="examtype">Exam Type</label>
						  <select class="form-control" id="selectExamTypeEdit" name="exam_type" required>
						          <option>Select Exam Type</option>
								 								 
							</select>
							<!-- <p id="divExamtype"></p> -->
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="examname">Name of Exam</label>
						   <input type="text" class="form-control" id="nameExam" name="name_exam"  required/>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="monthand year">Month and Year of Exam</label>
						   <input type="text" class="form-control datepicker-month-year" id="monthYear" name="month_year" required />
						</div>
					</div>	
					
			       <div class="col-md-3">
						<div class="form-group">
						   <label for="tentativedate">Tentative Date of Exam</label>
						   <input type="text" class="form-control datepicker" name="tentative_date" id="tentativeDate"  required/>
						</div>
					</div>	 
					  
				</div>
			
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
								   <label for="monthand feepaymentdate">Last Date of payment without fine</label>
								   <input type="text" class="form-control datepicker " placeholder="Without Fine" id="pay_without_fine"  name="pay_date" required/>						  
								</div>
							</div>		
						
							<div class="col-md-6">
								<div class="form-group">
								   <label for="monthand feepaymentdate">Last Date of payment with fine</label>
								   <input type="text" class="form-control datepicker" placeholder="With Fine"  name="pay_date_fine" id="pay_date_fine" required/>						  
								</div>
							</div>					
						
						<!-- <div class="col-md-4"> 
							<div class="form-group">
                        		<label>Instructions for Hall ticket (only pdf)</label>
                        		<div class="custom-file">
						  			<input type="file" class="custom-file-input"  accept="application/pdf"   id="instructionsFile">
						  			<label class="custom-file-label" for="customFile">Choose file</label>
								</div>
                      		</div>				
						</div> -->	
					</div>	
						<div class="row">
							<div class="col-md-12">
								<div class="form-group">
								   <label for="instructions">Instructions</label>
								  <textarea class="form-control" rows="5"  id="instructions" name="instructions" required > </textarea>
								</div>
							</div>					
						</div>						
								
					<div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Fee Settings</div>
				   	
				   	
	 	
		   	<div class="row">
				<div class="col-md-6">
				<label for="table">Select the fee heads </label>
				
					<div class="table-responsive">
						<table class="table" id="checkBoxTable">
							
						</table>
					</div>	
				</div>
				<div class="col-md-6 well" id="displayDiv">
			
				<label for="table">	Selected fee heads </label>
					<div class="table-responsive">
						<table class="table" id="displayTable1">
							
						</table>
					</div>
				</div>
			</div>					
					
				<div class="col-md-12">
				     <div class="col-md-3  well" >
				   	<button type="submit" class="btn btn-info">Update</button>
              </div>
            </div>
          </div>
          <!-- /.col-md-12 -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    
    <!-- /.main content -->
    
    </form>
  </div>
  
  

<script>
//global variables and fns

/* base url for exam management */
var BASE_URL = "/exam-management/api/v1/";
var MARKS_CONFIG_URL = "/mark-config/api/v1/academics/marks-management/evaluation-types-program/program-id/";
var ACADEMIC_YEAR_URL = "/academics/api/v1/academics/getDetailsByMasterId/masterId/83";

	
	/* fn to convert form data to json */
	$.fn.serializeObject = function()
	{
	    var o = {};
	    var a = this.serializeArray();
	    $.each(a, function() {
	        if (o[this.name] !== undefined) {
	            if (!o[this.name].push) {
	                o[this.name] = [o[this.name]];
	            }
	            o[this.name].push(this.value || '');
	        } else {
	            o[this.name] = this.value || '';
	        }
	    });
	    return o;
	 };

 
 	$('.datepicker').datepicker({
	    //format: 'yyyy-mm-dd',	
 		//startDate : moment() , //0
	    format: 'dd-mm-yyyy',
		autoclose:true,
		clearBtn:true,
		pickerPosition: "bottom-left"
		
	});  
	
 	
	$('.datepicker-month-year').datepicker({
	    format: 'M-yyyy',	
	    startView: "months", 
        minViewMode: "months",						   
		autoclose:true,
		clearBtn:true
	});
	

    
    
    //getStudentInfo();
   	function getStudentInfo()
	{

      $.ajax({
	   		url: "/students/getStudentsDetails-V3",
	   		method: 'GET',
	   		data:{"userCodes":$("#usercode").val()},
	   		success: function(data)
	   		{
	   		  console.log(data);
	   		  return data;
	   		  	   			
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
	   	});
	 }
    
 var selectedConfigArray=new Array();
//$(document).ready(function() {
	function getAllPrograms()
	{
	
		$.ajax({
	   		url:'/course/getAllCourses',
	   		method:'GET',
	   		success:function(data)
	   		{
	   		    setUpDropDown("selectProgram",data,"courseId","courseCode");
	   			$('#selectProgram').unbind().bind('change',function()
	   			{
	   				getAllActiveBatchesOfProgram($(this).val());
	   				loadEvaluationypes($(this).val());
	   			    if($("#displayTable").length){
	   				   $('#displayTable').empty();
	   			    }
	   			   if($(".configList").length){
	   				 
	   			    $('.configList').prop('checked', false);
	   			   }
	   			selectedConfigArray =[];
	   			
	   			});
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
	   	});
	}
	getAllPrograms();
	
    /* 
      To list the programs
	*/
	

	
	/**
	  To get all batches for the given programid
	*/
	 function getAllActiveBatchesOfProgram(programId)
	 {
	// $("#selectBatch").prop( "disabled", false );
		$.ajax(
		{
	  		url:'/batch/getAllActiveBatchesInAProgram',
	  	   	method:'GET',
	  	   	data:{"courseId":programId},
	  	   	success:function(data)
	  	   	{
	  	   	
	  	        setUpDropDown("selectBatch",data,"batchId","batchCode");
	  	   		$('#selectBatch').unbind().bind('change',function()
	   			{
	   				getAllActiveSemesterOfBatch($(this).val());
	   				
	   				
	   			});
	  	   		
	  	   	},
	  	   	error:function(err)
	  	   	{
	  	   		showMessage(err);
	  	   	}
	  	 });	  
	  }
	  
	  /**
	  To get all semesters the given batchid
	  */
	 function getAllActiveSemesterOfBatch(batchId)
	 {
		//$("#selectSemester").prop( "disabled", false );
		  $.ajax({
					"url" : "/batch/getAllSemestersInABatch",
					"method" : "GET",
					data : {"batchId":batchId},
					success :function(data) {
					console.log(data);
					    try{
						   if(data && data.length >0){
							   $('#selectSemester').empty();
							   $('#selectSemester').append('<option>Select Semester</option>');
							   for(var i=0;i< data.length;i++){
							   	   $("#selectSemester").append('<option value='+data[i]['semesterIdentity']['semesterCode']+'>'+data[i]['semesterIdentity']['semesterCode']+'</option>');
							   }
						 }
						}
						catch(e){
						    console.error(e);
						    showMessage(" Error occurred while processing semester list"); 
						}
													
						
					},
					error :function(e) {
					     showMessage(err);
					}
				});
		}
	 
	 function loadEvaluationypes(programId){
			$.ajax(
			{
				"url":MARKS_CONFIG_URL+programId,
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectRevaluationType",types,"id","evaluationType");
				}
			});
		
		}
		
		/* load exam types */
		function loadExamTypes(){
			$.ajax(
			{
				"url":BASE_URL+"exam-management/exam-types",
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectExamType",types,"id","type");
				}
			});
		
		}
		
		/* load academic year from look  up */
		function loadAcademicYear(){
			$.ajax(
			{
				"url": ACADEMIC_YEAR_URL ,//"/academics/api/v1/academics/getDetailsByMasterId/masterId/83",
			//	"url":"/nualsTest/api/v1/academics/getDetailsByMasterId/masterId/83",
				success:function(data)
				{
					 
					setUpDropDown("selectAcademicYear",data,"id","detailName");
				}
			});
		
		}
	 
		
//});
$( document ).ready(function() {
  
  $('#collapseTimeTable').hide();
  $('#collapseEditSchedule').hide();
  $('#divSchedules').hide();
  $('#divViewSchedules').hide();
  $('#divApproval').hide();
 //  $( "#divApproval" ).detach();
 
  var scheduleDataTable;
  var scheduleId;
  var selectedProgramId;
  

  /* **************************************************************************/
	/* exam fee settings  by rishi*/
	/* ****************************************************************************/
	
	var feeConfigMap={};// in case nuals need dynamic addition of fee config, we can set the values from an //api
//	var selectedConfigArray = new Array();
//	selectedConfigArray ="Exam-fee,Testing-Fee";
	////var pgmId=200;// set this from ur code
	//var examScheduleId="abc";//set this from ur code
	
	$.ajax(
	{
		"url":"/fees/getAllConfigByType",
		"data":{"configType":"Examination"},
		success:function(data)
		{
			console.log(data);
			if(data)
			{
				for(let i=0;i<data.length;i++)
				{
					feeConfigMap[data[i]['processName']]=data[i]['processName'];
				}
				setUpCheckBox(feeConfigMap,'checkBoxTable');
			}
		}
	});
	
	function setUpCheckBox(maparray,tableId)
	{
		selectedConfigArray=[];
		for (let key in maparray) 
		{
			if (maparray.hasOwnProperty(key)) 
			{
				var tr=$('<tr><td>'+maparray[key]+'</td><td><input  configkey="'+key+'"  id="'+key+'" type="checkbox" class="configList" style:"margin-right: 20px"></td></tr>');
				$('#'+tableId).append(tr);
				//selectedConfigArray.push(key);
				
			}
		}
		$('.configList').unbind().bind('change',function()
				{
					var configKey=$(this).attr('id');
				
					if($('#selectProgram').val() =="" ){
						
						toastr.error("Kindly select program!!");
						$(this).prop('checked', false);
									
					}
					else{
						if(this.checked)
						{
							addToArray(configKey);
						}
						else
						{
							removeFromArray(configKey);
						}
						getAmountDetails(configKey);
					}
				});
				
			
		
	}
	

	
	
	function addToArray(stud)

	{
		
	   if(selectedConfigArray.indexOf(String(stud)) !== -1)
	   {
	   }
	   else
	   {
		   selectedConfigArray.push(String(stud));  
	   }
	}
	function removeFromArray(stud)
	{
	   if(selectedConfigArray.indexOf(String(stud)) !== -1)
	   {
		   stud=String(stud)
		   selectedConfigArray = jQuery.grep(selectedConfigArray,function(value) 
		   {
			   return value != stud;
		   }); 
	   }
	}
	
	function displayInfo(data)
	{
		$('#displayTable1').empty();
		for(let i=0;i<data.length;i++)
		{
			var tr=$('<tr><td>'+feeConfigMap[data[i]['configKey']]+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
			$('#displayTable1').append(tr);
		}
	}
	
	function getAmountDetails(configKey)
	{
		//alert("inside amount"+selectedConfigArray);
		if(selectedConfigArray.length>0 && $('#selectProgram').val() != "" )
		{
			$.ajax(
			{
				"url":"/fees/getManyFeeHeadAmountMap",
				"data":{"pgmId":$('#selectProgram').val(),"feeIdentifierList":String(selectedConfigArray)},
				success:function(data)
				{
					
					var feeHeads = data.length;
					var configArray = selectedConfigArray.length;
										
					if(data.length == 0  || configArray != feeHeads ){
						toastr.error("No fee set for this program!!");
						 $('#'+configKey).prop('checked', false);
					     removeFromArray(configKey);
					}
					//else if( configArray != feeHeads )
						//toastr.error("No fee set for this program!!");
					else
					displayInfo(data);
				},
				error:function(e)
				{
					console.log("Error in calling ajax "+e);
				}
			});
		}
		else
		{
			
			$('#displayTable').empty();
		}	
	}
	
  $('#selectSemester').unbind().bind('change',function(){
	   
	   var program = $( "#selectProgram option:selected" ).val();
	   var batch = $( "#selectBatch option:selected" ).val();
	   var semester = $( "#selectSemester option:selected" ).val();
	   $('#divSchedules').show();
	   $('#collapseEditSchedule').hide();
	  scheduleDataTable =  $('#tblExamSchedule').DataTable({
            "language": {
                    "emptyTable": "No data available for the selected program / batch / semester"
                  },
			"processing": true,
			"destroy": true,
			"ajax":{ 
			    "url": BASE_URL+"schedule/list",
			    "type":"POST",
			     "data":{"program":program,"batch":batch,"semester":semester},
			    },
			"columns": [
			
			{ "data": "academic_year" },
			{ "data": "name_exam"},
			{ "data": "month_year" },//,"render": $.fn.dataTable.render.moment('Do MMM YY' )
		//	{ "data": "tentative_date"},
		  /*  {"data":"status"},*/
		    {"data":"approval_status"},
		    
			{
				"data": null,
				"defaultContent":
					'<a data-toggle="collapse" href="#"  class=""small-box-footer text-danger" id="btnDetails"><i class="fas fa-eye"></i></a>'
			},
			{
				"data": null,
				"defaultContent":
					'<a data-toggle="collapse" href="#"  class=""small-box-footer text-danger" id="btnEdit"> <i class="fas fa-edit"></i></a>' 
					 
			},
			/*{
				"data": null,
				"defaultContent":
					'<a data-toggle="collapse" href="#"  class=""small-box-footer text-danger" id="btnApprove"> <i class="fa fa-thumbs-up"></i></a>' 
					
			}*/
		]
		
		});
				

   
   $('#tblExamSchedule tbody').on('click', '#btnDetails', function () {
   
    $('#collapseTimeTable').show();
    $('#collapseEditSchedule').hide();
    $('#divViewSchedules').show();
    $('#divApproval').hide();
    
    var data = scheduleDataTable.row($(this).parents('tr')).data();
    	
    bindViewSchedule(data);
    bindTimeTable(data.id);
    getFeeDetails(data.id,data.program);
    scheduleId = data.id;
    selectedProgramId = data.program;
    var data = scheduleDataTable.row($(this).parents('tr')).data();
   	var timetableDataTable =  $('#tblExamTimetable').DataTable({
            "language": {
                    "emptyTable": "No data available for the selected exam name"
                  },
			"processing": true,
			"destroy": true,
			"ajax": BASE_URL+"time-table/list-schedule-id/"+data.id,
			"columns": [
			{ "data": "courseId" },
			{ "data": "courseName"},
			{ "data": "examDate" },//,"render": $.fn.dataTable.render.moment('Do MMM YY' )
			{ "data": "startDateTime" },
			{ "data": "endDateTime"}
		]
		});
	});
		
	
   $('#tblExamSchedule tbody').on('click', '#btnEdit', function () {
   
   
    $('#collapseTimeTable').hide();
    $('#divViewSchedules').hide();
    $('#collapseEditSchedule').show();  
   
     var data = scheduleDataTable.row($(this).parents('tr')).data();
 	console.log(data);  
 	
 	loadExamTypes(data.exam_type);
 	loadAcademicYear(data.academic_year);
 	getAllPrograms(data.program);
 	scheduleId = data.id;
 	getFeeDetails(data.id,data.program);
 	
 	
 	$('html, body').animate({
        scrollTop: $("#collapseEditSchedule").offset().top
  }, 1000);
 	
 	
 	

 

	$("#selectProgramEdit").val(data.program).trigger("change");
	$("#selectBatchEdit").val(data.batch).trigger("change");
 	$("#selectBatchEdit").val(data.batch).trigger("change");
 	$("#selectSemesterEdit").val(data.semester).trigger("change");
 	
 	$("#nameExam").val(data.name_exam);
	$("#monthYear").val(data.month_year);
	$("#tentativeDate").val( moment(data.tentative_date).format('DD-MM-YYYY'));
	$("#pay_without_fine").val( moment(data.pay_date).format('DD-MM-YYYY'));
	$("#pay_date_fine").val( moment(data.pay_date_fine).format('DD-MM-YYYY'));
	$("textarea#instructions").val(data.instructions);
	   
	//$("#selectExamTypeEdit option:contains(" +data.examType +")").attr("selected", "selected");
	//$("#selectExamTypeEdit").val(data.exam_type).trigger("change");
 
	});
		
		
	
	
	 
	 $('#tblExamSchedule tbody').on( 'click', 'tr', function () {
			
	        if ( $(this).hasClass('selected') ) {
	            $(this).removeClass('selected');
	        }
	        else {
	        	scheduleDataTable.$('tr.selected').removeClass('selected');
	            $(this).addClass('selected');
	        }
	    } );
	 
	
	});		
	/**
	   Bind the schedule details
	*/	
	function bindViewSchedule(data)
	{
	console.log(data.pay_date);
	   $("#academicYear").text(data.academic_year);
	   $("#program").text(data.programName);
	   $("#batch_sem").text(data.batchName + " - "+data.semester);
	   $("#exam_type").text(data.exam_type);
	   
	   $("#exam_name").text(data.name_exam);
	   $("#month_year").text(data.month_year);
	   $("#tentative_date").text( moment(data.tentative_date).format('D/MM/YYYY'));
	   $("#date_without_fine").text( moment(data.pay_date).format('D/MM/YYYY'));
	   $("#date_with_fine").text( moment(data.pay_date_fine).format('D/MM/YYYY'));
	   $("#instructions").text(data.instructions);
	
	
	}

	/**
	   Bind the Time table details
	*/	
	function bindTimeTable(scheduleId)
	{
	     $.ajax({
				   type: "GET",
				   url:  BASE_URL+"time-table/list-schedule-id/"+scheduleId,
				   headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				   },		   
				   success: function(result)
				   {
						$("#tblTimetable tbody").remove();	
						console.log(result.data);
						if(result.data.length>0)	
						{				
							$.each(result.data, function (key, value) {
								
								$("#tblTimetable").append($('<tbody><tr><td>' +  moment(value.examDate).format('D/MM/YYYY')+ '</td><td>'+  moment(value.examDate).format('dddd')+ '</td><td>' +value.courseId+ '</td><td>' +value.courseName+ '</td><td>'+  value.startDateTime +' - '+ value.endDateTime+'</td></tr></tbody>'));
							});
						}else{
							$("#tblTimetable").append($('<tbody><tr><td colspan="5" class="text-center">No data available</td></tr></tbody>'));
						}
								
					 
					 
				   },
			   		error:function(err)
			   		{
			   		  toastr.error("Failed to load time table details");
			   		}
				 });
	
	}
	
	
	
	
 
       
  /**
   * function to confirm for exam schedule
   */
    $('#formExamSchedule').unbind().bind('submit',function(event)
	{
				event.preventDefault();
				
			
		        var scheduleData = $(this).serializeObject();
		        scheduleData.id = scheduleId;
		        scheduleData.tentative_date =  moment($("#tentativeDate").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
		        scheduleData.pay_date = moment($("#pay_without_fine").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
		        scheduleData.pay_date_fine = moment($("#pay_date_fine").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
		        scheduleData.academic_year = $( "#selectAcademicYearEdit option:selected" ).text();
		        scheduleData.programName = $( "#selectProgramEdit option:selected" ).text();
		        scheduleData.program = $( "#selectProgramEdit" ).val();
		        scheduleData.batch = $( "#selectBatchEdit" ).val();
		        scheduleData.exam_type = $( "#selectExamTypeEdit option:selected" ).text();
			    scheduleData.batchName = $( "#selectBatchEdit option:selected" ).text();
			    scheduleData.semester = $( "#selectSemesterEdit option:selected" ).text();
			    scheduleData.status = "IN ACTIVE";
			    scheduleData.approval_status = "MODIFIED";
		        
		     /*	var scheduleFormDataJson = JSON.stringify(scheduleData);
		     	
		     //   console.log(scheduleFormDataJson);
		        
				//var file = $('#instructionsFile')[0].files[0];	
				var file = null;	
				let formData = new FormData();
				formData.append('file',file);
				formData.append('ExamSchedule',scheduleFormDataJson);
				*/
				
          var msg = {
					 title : "Exam Schedule",
					 msg : "Do you want to update this exam schedule?"
				}
		   ConfirmDialog(msg, "SAVE").then(function(response) {
							
					updateExamSchedule(scheduleData);
									
			}, function(error) {
					
				toastr.error("Exam Schedule updation cancelled !!");
					
			});
      
   });
   
   function updateExamSchedule(scheduleFormDataJson)
	{
               				
			    $.ajax(
		   		{
		   			url:BASE_URL+"schedule/update",
		   			method:"POST",
		   		    data:scheduleFormDataJson,
		   			success:function(data){
	   			
		   		  	   toastr.success("Schedule updatetd Successfully");
		   			   $("#collapseEditSchedule").hide();
		   			   //reset  	
		   			   $("#formExamSchedule")[0].reset(); 
		   			   $('#tblExamSchedule').DataTable().ajax.reload();
		   					   			
		   			},
			   		error:function(err)
			   		{
			   			toastr.error("Saving Exam Schedule failed !!");
			   			 			
			   		}
		   		});	
	 }	
		
  

   
   /**
	* To get fee details for the given schedule id
	*/
	 function getFeeDetails(scheduleId,programId)
	 {
		 console.log(scheduleId);
	   $.ajax({
		         url: BASE_URL+"schedule/fees/schedule-id/"+scheduleId,
		         async:false,
				 success: function(data)
		           {
		    		
					var config= data.data.configList;
					selectedConfigArray = config.split(",");
					bindFeeDetails(config,programId);
		           }, 
		           function(error) {
					
				       toastr.error("Failed loading Fee details !!");
					
			        }
		           
		         });
	 
	 
	 }
	 
	 function bindFeeDetails(config,programId)
	 {

	 $.ajax(
			{
				"url":"/fees/getManyFeeHeadAmountMap",
				"data":{"pgmId":programId,"feeIdentifierList":String(config)},
				success:function(data)
				{
					console.log(data.length);
					$('#displayTable').empty();
					$('#displayTable1').empty();
						for(let i=0;i<data.length;i++)
						{
							 var tr=$('<tr><td>'+data[i]['configKey']+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
							 var tr1=$('<tr><td>'+data[i]['configKey']+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
								      	    
					       
							$('#displayTable').append(tr);
							$('#displayTable1').append(tr1);
						}
						
						
				},
				error:function(e)
				{
					console.log("Error in calling ajax "+e);
					toastr.error("Fee not set for this program ");
				}
			});
			
			
	 }
	 
  
	 
	 
	 
	 /* 
     To list the programs
	*/
	
	function getAllPrograms(program)
	{
	
		$.ajax({
	   		url:'/course/getAllCourses',
	   		method:'GET',
	   		async:false,
	   		success:function(data)
	   		{
	   		    setUpDropDown("selectProgramEdit",data,"courseId","courseCode");
	   		  
	   		  
	   			$('#selectProgramEdit').unbind().bind('change',function()
	   			{
	   				
	   				getAllActiveBatchesOfProgram($(this).val());
	   				
	   			});
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
	   	});
	}
	
	/**
	  To get all batches for the given programid
	*/
	 function getAllActiveBatchesOfProgram(programId)
	 {
	// $("#selectBatch").prop( "disabled", false );
		$.ajax(
		{
	  		url:'/batch/getAllActiveBatchesInAProgram',
	  	   	method:'GET',
	  	   	data:{"courseId":programId},
	  	   	async:false,
	  	   	success:function(data)
	  	   	{
	  	   	
	  	        setUpDropDown("selectBatchEdit",data,"batchId","batchCode");
	  	       	$('#selectBatchEdit').unbind().bind('change',function()
	 	   			{
	 	   				getAllActiveSemesterOfBatch($(this).val());
	 	   				
	 	   			});
	  	   		
	  	   	},
	  	   	error:function(err)
	  	   	{
	  	   		showMessage(err);
	  	   	}
	  	 });	  
	  }
	  

	  	   		
	 
	  /**
	  To get all semesters the given batchid
	  */
	 function getAllActiveSemesterOfBatch(batchId)
	 {
		//$("#selectSemester").prop( "disabled", false );
		  $.ajax({
					"url" : "/batch/getAllSemestersInABatch",
					"method" : "GET",
					data : {"batchId":batchId},
					async:false,
					success :function(data) {
					console.log(data);
					    try{
						   if(data && data.length >0){
							   $('#selectSemesterEdit').empty();
							   $('#selectSemesterEdit').append('<option>Select Semester</option>');
							   for(var i=0;i< data.length;i++){
							   	   $("#selectSemesterEdit").append('<option>'+data[i]['semesterIdentity']['semesterCode']+'</option>');
							   }
						 }
						}
						catch(e){
						    console.error(e);
						    showMessage(" Error occurred while processing semester list"); 
						}
													
						
					},
					error :function(e) {
					     showMessage(err);
					}
				});
		}  
	 
	 function loadExamTypes(examType){
			$.ajax(
			{
				"url":BASE_URL+"exam-management/exam-types",
				async:false,
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectExamTypeEdit",types,"id","type");
					$("#selectExamTypeEdit option:contains(" + examType +")").attr("selected", "selected");
					//$("#selectExamTypeEdit").val(examType).trigger("change");
				}
			});
		
		}
		
		function loadAcademicYear(academic_year){
			$.ajax(
			{
			//	"url":"academics/api/v1/academics/getDetailsByMasterId/masterId/83",
				"url":ACADEMIC_YEAR_URL,
				
				success:function(data)
				{
					 
					setUpDropDown("selectAcademicYearEdit",data,"id","detailName");
					$("#selectAcademicYearEdit option:contains(" + academic_year +")").attr("selected", "selected");
				}
			});
		
		}
	 
});
 var ConfirmDialog = function (data,type){

 var TYPE;
 var ICON ;
 var BTN_CLASS;

	 if ( type == 'SAVE'){
		 TYPE = 'green';
		 ICON =  'fa fa-save';
		 BTN_CLASS = 'btn-success';
	 }
	 else if ( type == 'DELETE'){
		 TYPE = 'red';
		 ICON =  'fa fa-trash';
		 BTN_CLASS = 'btn-danger';	 
	 }
	 else if ( type == 'APPROVE'){
		 TYPE = 'red';
		 ICON =  'fa fa-thumbs-up';
		 BTN_CLASS = 'btn-danger';	 
	 }
	 else
	 {
		 TYPE = 'red';
		 ICON =  'fa fa-warning';
		 BTN_CLASS = 'btn-warning';	
	 }
	 var DialogPromise = function (resolve, reject) {
	    
	     $.confirm({
	        title: data.title,
	        content:data.msg,
	        closeIcon : true,
	        type: TYPE,
	        icon: ICON,
	        offsetTop: 40,	      
	        bgOpacity :'0.7',
	        buttons: {  
	            ok: {
	                text: "<b> Yes </b>",	            
	                keys: ['enter'],
	                action: function(){	                    
	                     resolve(true); 	                    
	                }
	            },
	            no: function(){
	              text: "<b> No </b>",	                  
	                    reject(false); 
	            }
	        }
     });    
    
   };    
    return  new  Promise (DialogPromise);
 }
    
</script>  


