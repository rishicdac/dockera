<!-- Main content -->
<div class="content">
	<div class="container-fluid">
		<div class="row">
			<!-- /.col-md-12 -->
			<div class="col-lg-12">

				<div class="card card-info card-outline">
					<div class="card-header ">
						<h5 class="m-0 card-title"> Revaluation / Scrutiny Schedule - Edit / View</h5>
					</div>
					<div class="card-body ">
					<form id="formRevaluation">
							<div class="row">
						
							<div class="col-md-3">
								<div class="form-group">
									<label for="program">Program</label> <select
										class="form-control" id="selectProgram" name="program"
										required>
										<option>Select Program</option>
									</select>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="batch">Batch</label> <select class="form-control"
										id="selectBatch" name="batch" required>
										<option>Select Batch</option>
									</select>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label for="semester">Semester</label> <select
										class="form-control" id="selectSemester" name="semester"
										required>
										<option>Select Semester</option>
									</select>
								</div>
							</div>
							   <div class="col-md-3">
								<div class="form-group">
									<label for="course">Exam Name</label> <select
										class="form-control" id="selectExamName" name="selectExamName" required>
										<option>Select Exam Name</option>

									</select>
								</div>
							</div>
						</div>
                          <div class="row">
	                
							<div class="col-md-3">
								<div class="col-md-4 pt-4 mt-1">
										<button type="submit" class="btn btn-sm btn-info" id="generateListBtn">Submit</button>	
									</div>
							</div>

                   </div>

</form>
			<!-- /.main content -->
</div>
<!-- /.content-wrapper -->
</div>
</div>			
</div>
</div>
	<div class="card" id="divRevaluation" style="display:none;">
		  		<!-- <div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Time table</div> -->
					<div class="table-responsive">
					  <table id="tblRevaluation" class="table table table-striped table-bordered  display" style="width:100%">
						<thead>
							<tr>
							  <th>Exam Name </th>
							  <th>Schedule Type</th>
							  <th> Last date to Apply</th>
							  <th>Approval Status</th>
							  <th>View </th>			 
							  <th>Edit</th>
							 
							</tr>
							</thead>
					  </table>				  
					 
					</div>
					<!-- /.table-responsive -->
				 
				</div>
				

	
 		<div  id="divViewSchedules" style="display:none;">
			<div class="row" >
			<div class="col-lg-12">
			<div class="invoice p-3 mb-3">
			<div class="tab-content">
			<div class="post">
			<div class="user-block text-center">
			<img class="img-circle img-bordered-sm" src="exam-management_proxy/exam-management_public/img/nuals.jpg" alt="user image" style="width:70px;height:70px;">
			<span class="username text-center">
			<h3>The National University of Advanced Legal Studies</h3>
			</span>
			<h6 id="applnType" style="font-weight:600"> </h6>
			<hr/>
			</div>
			</div>
			</div>
			
			<div class="row mb-4">
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Academic Year : <br/><code id="academicYear"></code></h5>
			</div>
			</div>
			
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Programme  : <br/><code id="programView"> </code></h5>
			</div>
			</div>
			<div class="col-md-3">
			<div class="description-block border-right">
			<h5 class="description-header">Batch / Semester : <br/><code id="batch_sem"></code></h5>
			</div>
			</div>
			
			<div class="col-md-3">
			<div class="description-block">
			<h5 class="description-header">Exam Name : <br/><code id="exam_type"></code></h5>
			</div>
			</div>
			</div>
			<hr>
			<dl class="row pl-5 ml-3">
			<dt class="col-sm-4 description-header" >Name of the Exam : </dt>
			<dd class="col-sm-8" id="exam_name"> 2014-2019 Master of Law</dd>
			
			<dt class="col-sm-4">Last date to Apply:</dt>
			<dd class="col-sm-8" id="tentative_date">12-01-2020</dd>
			<dt class="col-sm-4">Last Date of payment without fine:</dt>
			<dd class="col-sm-8" id="date_without_fine">12-12-2019</dd>
			<dt class="col-sm-4">Last Date of payment with fine:</dt>
			<dd class="col-sm-8" id="date_with_fine">23-12-2019</dd>
			<dt class="col-sm-4">Instructions:</dt>
			<dd class="col-sm-8" id="instructions">Testing </dd>
			<dt class="col-sm-4"> Fee Structure:</dt>
			<dd class="col-sm-8" id="">
			     <div class="table-responsive">
					<table class="table" id="displayTable">					
						</table>
					</div>
			</dd>
			</dl>
				
		
			</div>
			</div>
			</div>
			</div>
			<!-- Preview Schedule-->    
 <!-- Main content -->
    <div class="content"  id="editRevaluation" style="display:none;">
    <form id="formExamSchedule" >
      <div class="container-fluid">
        <div class="row">          
          <!-- /.col-md-12 -->
          <div class="col-lg-12">           

            <div class="card card-info card-outline">
              <div class="card-header ">
                <h5 class="m-0 card-title">Revaluation / Scrutiny  Schedule</h5>
				
              </div>
              <div class="card-body ">
              <div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Program Details</div>
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
						   <label for="academic Year">Academic Year</label>
						   <select class="form-control" id="selectAcademicYearEdit" name="academic_year" required>
								  <option>Select</option>
							
							</select>
						</div>
					</div>	
					<div class="col-md-3">
						<div class="form-group">
						   <label for="program">Program</label>
						   <select class="form-control" id="selectProgramEdit" name="program" required>
								<option>Select Program</option>	
							</select>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="batch">Batch</label>
						   <select class="form-control" id="selectBatchEdit" name="batch" required>
								  <option>Select Batch</option>							  
							</select>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
						   <label for="semester">Semester</label>
						   <select class="form-control" id="selectSemesterEdit" name="semester" required>
								   <option>Select Semester</option>
							</select>
						</div>
					</div>	
				</div>
				<div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Exam  and Revaluation Details</div>
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
						   <label for="examtype">Exam Type</label>
						   <select class="form-control" id="selectExamTypeEdit" name="exam_type" required>
						          <option>Select Exam Type</option>
																 
							</select>
						</div>
					</div>
					<div class="col-md-5">
						<div class="form-group">
						   <label for="examname">Name of Exam</label>
						   <!-- <input type="text" class="form-control" id="nameExam" name="name_exam" placeholder="Name of the exam" required /> -->
						     <select class="form-control" id="selectExamNameEdit" name="name_exam" required>
						          <option>Select Exam Name</option>
																 
							</select>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
						   <label for="examname">Schedule Type</label>
						 <select class="form-control" id="selectRevaluationTypeEdit" name="exam_type" required>
						          <option>Select Schedule Type</option>
						            <option value="1">Scrutiny</option>
						            <option value="2">Revaluation</option>
																 
							</select>
							</div>
					</div>	 
					  
				</div>
				<div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Payment Details and Instructions</div>
				<div class="row">
						<div class="col-md-4">
								<div class="form-group">
								   <label for="monthand feepaymentdate">Last Date to Apply</label>
								   <input type="text" class="form-control datepicker " placeholder="date to apply" name="tentative_date" id="tentativeDateEdit"  required/>						  
								</div>
							</div>		
						
						
							<div class="col-md-4">
								<div class="form-group">
								   <label for="monthand feepaymentdate">Last Date of payment without fine</label>
								   <input type="text" class="form-control datepicker " placeholder="Without Fine" id="dateWithouFine"  name="pay_date" required/>						  
								</div>
							</div>		
						
							<div class="col-md-4">
								<div class="form-group">
								   <label for="monthand feepaymentdate">Last Date of payment with fine</label>
								   <input type="text" class="form-control datepicker" placeholder="With Fine"  name="pay_date_fine" id="dateFine" required/>						  
								</div>
							</div>					
						<!--  	<div class="col-md-4">
							 <div class="form-group">
                        		<label>Instructions for Hall ticket (only pdf)</label>
                        		<div class="custom-file">
						  			<input type="file" class="custom-file-input"  accept="application/pdf"   id="instructionsFile" placeholder="Instructions to be placed in hall tickets"  required>
						  			<label class="custom-file-label" for="customFile">Choose file</label>
								</div>
                      		</div>				
						</div> -->	
					</div>
						<div class="row">
							<div class="col-md-12">
								<div class="form-group">
								   <label for="instructions">Instructions</label>
								  <textarea class="form-control" rows="5" placeholder="" id="instructions" name="instructions" required>
 1. Incomplete Application will be summarily rejected 
 2. After Submitting the application, Fee need to be paid under payment section 
 3.No application will be registered unless the prescribed fee is paid				  </textarea>
								</div>
							</div>					
						</div>						
		<div class="external-event bg-gray ui-draggable ui-draggable-handle" style="position: relative;">Fee Settings</div>
				   	
				   	
	 	
		   	<div class="row">
				<div class="col-md-6">
				<label for="table">Select the fee heads </label>
				
					<div class="table-responsive">
						<table class="table" id="checkBoxTable">
							
						</table>
					</div>	
				</div>
				<div class="col-md-6 well" id="displayDiv">
			
				<label for="table">	Selected fee heads </label>
					<div class="table-responsive">
						<table class="table" id="displayTable1">
							
						</table>
					</div>
				</div>
			</div>
		
				   	
				   	
				   	
				   	<button type="submit" class="btn btn-info">Update</button>
				   	
              </div>
            </div>
           
             
          </div>
          <!-- /.col-md-12 -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.main content -->
    </form>
  </div>
  <!-- /.content-wrapper -->

<script>

//global variables and fns

/* base url for exam management */
var BASE_URL = "/exam-management/api/v1/";
var MARKS_CONFIG_URL = "/mark-config/api/v1/academics/marks-management/evaluation-types-program/program-id/";
var ACADEMIC_YEAR_URL = "/academics/api/v1/academics/getDetailsByMasterId/masterId/83";

	
	/* fn to convert form data to json */
	$.fn.serializeObject = function()
	{
	    var o = {};
	    var a = this.serializeArray();
	    $.each(a, function() {
	        if (o[this.name] !== undefined) {
	            if (!o[this.name].push) {
	                o[this.name] = [o[this.name]];
	            }
	            o[this.name].push(this.value || '');
	        } else {
	            o[this.name] = this.value || '';
	        }
	    });
	    return o;
	 };

 
 	$('.datepicker').datepicker({
	    //format: 'yyyy-mm-dd',	
 		//startDate : moment() , //0
	    format: 'dd-mm-yyyy',
		autoclose:true,
		clearBtn:true,
		pickerPosition: "bottom-left"
		
	});  
	
 	
	$('.datepicker-month-year').datepicker({
	    format: 'M-yyyy',	
	    startView: "months", 
        minViewMode: "months",						   
		autoclose:true,
		clearBtn:true
	});
	

    
    
    //getStudentInfo();
   	function getStudentInfo()
	{

      $.ajax({
	   		url: "/students/getStudentsDetails-V3",
	   		method: 'GET',
	   		data:{"userCodes":$("#usercode").val()},
	   		success: function(data)
	   		{
	   		  console.log(data);
	   		  return data;
	   		  	   			
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
	   	});
	 }
    
 var selectedConfigArray=new Array();
//$(document).ready(function() {
	function getAllPrograms()
	{
	
		$.ajax({
	   		url:'/course/getAllCourses',
	   		method:'GET',
	   		success:function(data)
	   		{
	   		    setUpDropDown("selectProgram",data,"courseId","courseCode");
	   			$('#selectProgram').unbind().bind('change',function()
	   			{
	   				getAllActiveBatchesOfProgram($(this).val());
	   				loadEvaluationypes($(this).val());
	   			    if($("#displayTable").length){
	   				   $('#displayTable').empty();
	   			    }
	   			   if($(".configList").length){
	   				 
	   			    $('.configList').prop('checked', false);
	   			   }
	   			selectedConfigArray =[];
	   			
	   			});
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
	   	});
	}
	getAllPrograms();
	
    /* 
      To list the programs
	*/
	

	
	/**
	  To get all batches for the given programid
	*/
	 function getAllActiveBatchesOfProgram(programId)
	 {
	// $("#selectBatch").prop( "disabled", false );
		$.ajax(
		{
	  		url:'/batch/getAllActiveBatchesInAProgram',
	  	   	method:'GET',
	  	   	data:{"courseId":programId},
	  	   	success:function(data)
	  	   	{
	  	   	
	  	        setUpDropDown("selectBatch",data,"batchId","batchCode");
	  	   		$('#selectBatch').unbind().bind('change',function()
	   			{
	   				getAllActiveSemesterOfBatch($(this).val());
	   				
	   				
	   			});
	  	   		
	  	   	},
	  	   	error:function(err)
	  	   	{
	  	   		showMessage(err);
	  	   	}
	  	 });	  
	  }
	  
	  /**
	  To get all semesters the given batchid
	  */
	 function getAllActiveSemesterOfBatch(batchId)
	 {
		//$("#selectSemester").prop( "disabled", false );
		  $.ajax({
					"url" : "/batch/getAllSemestersInABatch",
					"method" : "GET",
					data : {"batchId":batchId},
					success :function(data) {
					console.log(data);
					    try{
						   if(data && data.length >0){
							   $('#selectSemester').empty();
							   $('#selectSemester').append('<option>Select Semester</option>');
							   for(var i=0;i< data.length;i++){
							   	   $("#selectSemester").append('<option value='+data[i]['semesterIdentity']['semesterCode']+'>'+data[i]['semesterIdentity']['semesterCode']+'</option>');
							   }
						 }
						}
						catch(e){
						    console.error(e);
						    showMessage(" Error occurred while processing semester list"); 
						}
													
						
					},
					error :function(e) {
					     showMessage(err);
					}
				});
		}
	 
	 function loadEvaluationypes(programId){
			$.ajax(
			{
				"url":MARKS_CONFIG_URL+programId,
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectRevaluationType",types,"id","evaluationType");
				}
			});
		
		}
		
		/* load exam types */
		function loadExamTypes(){
			$.ajax(
			{
				"url":BASE_URL+"exam-management/exam-types",
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectExamType",types,"id","type");
				}
			});
		
		}
		
		/* load academic year from look  up */
		function loadAcademicYear(){
			$.ajax(
			{
				"url": ACADEMIC_YEAR_URL ,//"/academics/api/v1/academics/getDetailsByMasterId/masterId/83",
			//	"url":"/nualsTest/api/v1/academics/getDetailsByMasterId/masterId/83",
				success:function(data)
				{
					 
					setUpDropDown("selectAcademicYear",data,"id","detailName");
				}
			});
		
		}
	 
		
//});
$( document ).ready(function() {
  

  var scheduleDataTable;
  var scheduleId;
  var activeScheduleId;
 
  /* **************************************************************************/
	/* exam fee settings  by rishi*/
	/* ****************************************************************************/
	
	var feeConfigMap={};// in case nuals need dynamic addition of fee config, we can set the values from an //api
	var selectedConfigArray=new Array();
	selectedConfigArray ="Exam-fee,Testing-Fee";
	var pgmId=200;// set this from ur code
	var examScheduleId="abc";//set this from ur code
	
	$.ajax(
	{
		"url":"/fees/getAllConfigByType",
		"data":{"configType":"Examination"},
		success:function(data)
		{
			console.log(data);
			if(data)
			{
				for(let i=0;i<data.length;i++)
				{
					feeConfigMap[data[i]['processName']]=data[i]['processName'];
				}
				setUpCheckBox(feeConfigMap,'checkBoxTable');
			}
		}
	});
	
	function setUpCheckBox(maparray,tableId)
	{
		selectedConfigArray=[];
		for (let key in maparray) 
		{
			if (maparray.hasOwnProperty(key)) 
			{
				var tr=$('<tr><td>'+maparray[key]+'</td><td><input  configkey="'+key+'"  id="'+key+'" type="checkbox" class="configList" style:"margin-right: 20px"></td></tr>');
				$('#'+tableId).append(tr);
				//selectedConfigArray.push(key);
				
			}
		}
		$('.configList').unbind().bind('change',function()
		{
			
			var configKey=$(this).attr('id');
			if(this.checked)
			{
				addToArray(configKey);
			}
			else
			{
				removeFromArray(configKey);
			}
			getAmountDetails();		
		});
		
	}
	

	
	
	function addToArray(stud)
	{
	   if(selectedConfigArray.indexOf(String(stud)) !== -1)
	   {
	   }
	   else
	   {
		   selectedConfigArray.push(String(stud));  
	   }
	}
	function removeFromArray(stud)
	{
	   if(selectedConfigArray.indexOf(String(stud)) !== -1)
	   {
		   stud=String(stud)
		   selectedConfigArray = jQuery.grep(selectedConfigArray,function(value) 
		   {
			   return value != stud;
		   }); 
	   }
	}
	
	function displayInfo(data)
	{
		$('#displayTable1').empty();
		for(let i=0;i<data.length;i++)
		{
			var tr=$('<tr><td>'+feeConfigMap[data[i]['configKey']]+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
			$('#displayTable1').append(tr);
		}
	}
	
	function getAmountDetails()
	{
		if(selectedConfigArray.length>0)
		{
			$.ajax(
			{
				"url":"/fees/getManyFeeHeadAmountMap",
				"data":{"pgmId":$('#selectProgramEdit').val(),"feeIdentifierList":String(selectedConfigArray)},
				success:function(data)
				{
					
					var feeHeads = data.length;
					var configArray = selectedConfigArray.length;
										
					if(data.length == 0 )
						toastr.error("No fee set for this program!!");
					else if( configArray != feeHeads )
						toastr.error("No fee set for this program!!");
					else
					displayInfo(data);
				},
				error:function(e)
				{
					console.log("Error in calling ajax "+e);
				}
			});
		}
		else
		{
			$('#displayTable1').empty();
		}	
	}
	
	/* ***************************************************************************************************** */
  
  $('#selectSemester').unbind().bind('change',function(){
	
	   var program = $( "#selectProgram option:selected" ).val();
	   var batch = $( "#selectBatch option:selected" ).val();
	   var semester = $( "#selectSemester option:selected" ).val();
	 
	   $.ajax({
   	   	   "url": BASE_URL+"schedule/list",
		   "type":"POST",
		    "data":{"program":program,"batch":batch,"semester":semester},
	   		success: function(data)
	   		{
	   		    var examDetails = data.data;
	   		  	
	   		 setUpDropDown("selectExamName",examDetails,"id","name_exam");
	   		   
	   		   
	   		},
	   		error:function(err)
	   		{
	   			showMessage(err);
	   		}
       });
	});
  $('#selectSemesterEdit').unbind().bind('change',function(){
		
	  var exam_type = $( "#selectExamTypeEdit option:selected" ).text();
	     var program = $( "#selectProgramEdit option:selected" ).val();
		   var batch = $( "#selectBatchEdit option:selected" ).val();
		   var semester = $( "#selectSemesterEdit option:selected" ).val();
		 
		 $.ajax({
	  	   	   "url": BASE_URL+"schedule/type/list",
			   "type":"POST",
			    "data":{"program":program,"batch":batch,"semester":semester,"exam_type":exam_type},
	  		success: function(data)
	  		{
	  		    var examDetails = data.data;
	  		  	
	  		   setUpDropDown("selectExamNameEdit",examDetails,"id","name_exam");
	  		 
	  		   
	  		},
	  		error:function(err)
	  		{
	  			showMessage(err);
	  		}
	  	});
		
	});
  
  /*
   * load revaluation details
   */ 
   $('#formRevaluation').submit(function (event) {
          event.preventDefault();
     
   	   		  	
   	   	       bindDetails();
   	   		   
   	   		
   	});
  
   /*
    * bind the schedule and revaluation details
    */   
   function bindDetails()
   {
	   var scheduleId = $( "#selectExamName option:selected" ).val();
   	   var evalType = $( "#selectEvalType option:selected" ).val();
   	   
	   
		$("#divRevaluation").show();
	 	var statusDataTable =  $('#tblRevaluation').DataTable({
	           "language": {
                    "emptyTable": "Revaluation/ Scrutiny Schedule not found  for the selected exam name"
                  },
			"processing": true,
			"destroy": true,
			"ajax":BASE_URL+"revaluation/list/schedule-id/"+scheduleId,
			"columns": [
			{ "data": "examName" },
			{ "data": "evalTypeName"},
		    { "data": "lastDateApply","render": function(data){return moment(data).format('DD-MM-YYYY')}},
			{"data":"approvalStatus"},
			{
					"data": null,
					"defaultContent":
						'<a data-toggle="collapse" href="#"  class=""small-box-footer text-danger" id="btnDetails"><i class="fas fa-eye"></i></a>'
			},
			{
					"data": null,
					"defaultContent":
						'<a data-toggle="collapse" href="#"  class=""small-box-footer text-danger" id="btnEdit"> <i class="fas fa-edit"></i></a>' 
						 
			}
		]
		});
		
	 	
	 	  $('#tblRevaluation tbody').on('click', '#btnDetails', function () {
	 	      
	 	        var data = statusDataTable.row($(this).parents('tr')).data();
	            
	               
	               $("#divViewSchedules").show();
	               $("#editRevaluation").hide();
		 		   $("#applnType").text(data.evalTypeName+ "  Schedule");
		 		   $("#academicYear").text(data.academicYear);
		 		   $("#programView").text(data.program);
		 		   $("#batch_sem").text(data.batch + " - "+data.semester);
		 		   $("#exam_type").text(data.examName);
		 		   $("#exam_name").text(data.examName);
		 		   $("#tentative_date").text( moment(data.lastDateApply).format('D/MM/YYYY'));
		 		   $("#date_without_fine").text( moment(data.dateWithoutFine).format('D/MM/YYYY'));
		 		   $("#date_with_fine").text( moment(data.dateWithFine).format('D/MM/YYYY'));
		 		   $("#instructions").text(data.instructions);
		 		   bindFeeDetails(data.feeSettings,data.programId);
		 		   selectedConfigArray =  data.feeSettings.split(",");
	            
	 	  });
	
		  $('#tblRevaluation tbody').on('click', '#btnEdit', function () {
	 	      
	 	      var data = statusDataTable.row($(this).parents('tr')).data();
	 	      $("#divViewSchedules").hide();
	 	      $("#editRevaluation").show();
	      
	 	     
	 	  	loadAcademicYear(data.academicYear);
	 	  	getAllPrograms(data.programId);
	 	  	activeScheduleId = data.id;
	 	
	 	   bindFeeDetails(data.feeSettings,data.programId);
	 	//  	$("#selectRevaluationTypeEdit option:contains(" + data.evalType +")").attr("selected", "selected");
	 	 
	 	  	$('html, body').animate({
	 	         scrollTop: $("#editRevaluation").offset().top
	 	   }, 1000);
	 	  	

	 	   loadExamTypes(data.examType);

	 	 	$("#selectProgramEdit").val(data.programId).trigger("change");
	 	 	$("#selectBatchEdit").val(data.batchId).trigger("change");
	 	  	$("#selectSemesterEdit").val(data.semester).trigger("change");
	 	 	$("#tentativeDateEdit").val( moment(data.lastDateApply).format('DD-MM-YYYY'));
	 	 	$("#dateWithouFine").val( moment(data.dateWithoutFine).format('DD-MM-YYYY'));
	 	 	$("#dateFine").val( moment(data.dateWithFine).format('DD-MM-YYYY'));
	 	 	$("textarea#instructions").val(data.instructions);
	 	 	$("#selectExamNameEdit option:contains(" + data.examName +")").attr("selected", "selected");
	 	 	$("#selectExamNameEdit").val(data.examName).trigger("change");   
	 		$("#selectRevaluationTypeEdit").val(data.evalType).trigger("change");
	 	  	
	 	 	
	 	  });
	   
   }

   


 function bindFeeDetails(selectedConfigArray,programId)
 {
	 console.log(selectedConfigArray);
	 console.log(programId);

    $.ajax(
		{
			"url":"/fees/getManyFeeHeadAmountMap",
			"data":{"pgmId":programId,"feeIdentifierList":String(selectedConfigArray)},
			success:function(data)
			{
				console.log(data.length);
				$('#displayTable').empty();
				$('#displayTable1').empty();
					for(let i=0;i<data.length;i++)
					{
						 var tr=$('<tr><td>'+data[i]['configKey']+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
						 var tr1=$('<tr><td>'+data[i]['configKey']+'</td><td>'+data[i]['feeAmount']+'</td></tr>');
							      	    
				       
						$('#displayTable').append(tr);
						$('#displayTable1').append(tr1);
					}
					
					
			},
			error:function(e)
			{
				console.log("Error in calling ajax "+e);
				toastr.error("Fee not set for this program ");
			}
		});
		
		
 }
 
 /* 
 To list the programs
*/

function getAllPrograms(program)
{

	$.ajax({
   		url:'/course/getAllCourses',
   		method:'GET',
   		async:false,
   		success:function(data)
   		{
   		    setUpDropDown("selectProgramEdit",data,"courseId","courseCode");
   		  
   		  
   			$('#selectProgramEdit').unbind().bind('change',function()
   			{
   				
   				getAllActiveBatchesOfProgram($(this).val());
   			 loadEvaluationypes($(this).val());
   			});
   		},
   		error:function(err)
   		{
   			showMessage(err);
   		}
   	});
}

/**
  To get all batches for the given programid
*/
 function getAllActiveBatchesOfProgram(programId)
 {
// $("#selectBatch").prop( "disabled", false );
	$.ajax(
	{
  		url:'/batch/getAllActiveBatchesInAProgram',
  	   	method:'GET',
  	   	data:{"courseId":programId},
  	   	async:false,
  	   	success:function(data)
  	   	{
  	   	
  	        setUpDropDown("selectBatchEdit",data,"batchId","batchCode");
  	 	    $('#selectBatchEdit').unbind().bind('change',function()
 	   			{
 	   				getAllActiveSemesterOfBatch($(this).val());
 	   			   
 	   			});
  	   		
  	   	},
  	   	error:function(err)
  	   	{
  	   		showMessage(err);
  	   	}
  	 });	  
  }
  
 function loadEvaluationypes(programId){
		$.ajax(
		{
			"url":MARKS_CONFIG_URL+programId,
			async:false,
			success:function(data)
			{
				types= data.data; 
				setUpDropDown("selectRevaluationTypeEdit",types,"id","evaluationType");
			}
		});
	
	}
  	   		
 
  /**
  To get all semesters the given batchid
  */
 function getAllActiveSemesterOfBatch(batchId)
 {
	//$("#selectSemester").prop( "disabled", false );
	  $.ajax({
				"url" : "/batch/getAllSemestersInABatch",
				"method" : "GET",
				data : {"batchId":batchId},
				async:false,
				success :function(data) {
				console.log(data);
				    try{
					   if(data && data.length >0){
						   $('#selectSemesterEdit').empty();
						   $('#selectSemesterEdit').append('<option>Select Semester</option>');
						   for(var i=0;i< data.length;i++){
						   	   $("#selectSemesterEdit").append('<option>'+data[i]['semesterIdentity']['semesterCode']+'</option>');
						   }
					 }
					}
					catch(e){
					    console.error(e);
					    showMessage(" Error occurred while processing semester list"); 
					}
												
				//	loadExamNames();
				},
				error :function(e) {
				     showMessage(err);
				}
			});
	}  
 
 function loadExamNames(){
	 
     var exam_type = $( "#selectExamTypeEdit option:selected" ).text();
     var program = $( "#selectProgramEdit option:selected" ).val();
	   var batch = $( "#selectBatchEdit option:selected" ).val();
	   var semester = $( "#selectSemesterEdit option:selected" ).val();
	  
	   
	 $.ajax({
  	   	   "url": BASE_URL+"schedule/type/list",
		   "type":"POST",
		    "data":{"program":program,"batch":batch,"semester":semester,"exam_type":exam_type},
  		success: function(data)
  		{
  		    var examDetails = data.data;
  		  	
  		   setUpDropDown("selectExamNameEdit",examDetails,"id","name_exam");
  		 
  		   
  		},
  		error:function(err)
  		{
  			showMessage(err);
  		}
  	});
	
	}
	
	function loadAcademicYear(academic_year){
		$.ajax(
		{
			//"url":"academics/api/v1/academics/getDetailsByMasterId/masterId/83",
			"url":ACADEMIC_YEAR_URL,
			success:function(data)
			{
				 
				setUpDropDown("selectAcademicYearEdit",data,"id","detailName");
				$("#selectAcademicYearEdit option:contains(" + academic_year +")").attr("selected", "selected");
			}
		});
	
	}
 
	 function loadExamTypes(examType){
			$.ajax(
			{
				"url":BASE_URL+"exam-management/exam-types",
				success:function(data)
				{
					types= data.data; 
					setUpDropDown("selectExamTypeEdit",types,"id","type");
					$("#selectExamTypeEdit option:contains(" + examType +")").attr("selected", "selected");
					loadExamNames();
				}
			});
		
		}
		
  
	 
	 
     
	  /**
	   * function to confirm for exam schedule
	   */
	    $('#formExamSchedule').unbind().bind('submit',function(event)
		{
					event.preventDefault();
				
				    var scheduleData = {};
				    scheduleData.id = activeScheduleId; 
			        scheduleData.scheduleId = $("#selectExamNameEdit option:selected" ).val(); 
			        scheduleData.evalType = $( "#selectRevaluationTypeEdit option:selected" ).val(); 
			        scheduleData.evalTypeName = $( "#selectRevaluationTypeEdit option:selected" ).text(); 
			        scheduleData.instructions = $( "textarea#instructions" ).val(); 
			        scheduleData.lastDateApply =  moment($("#tentativeDateEdit").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
			        scheduleData.dateWithoutFine = moment($("#dateWithouFine").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
			        scheduleData.dateWithFine = moment($("#dateFine").val(),'DD-MM-YYYY').format('YYYY-MM-DD');
			       
			        if (scheduleData.dateWithoutFine > scheduleData.dateWithFine) {
			        	toastr.error("Date of Payment with fine cannot be eariler   !!");
			        	return;
			        }
			        if ($("textarea#instructions").val().length == 0) {
			         	alert($("#instructions").val());
			        	toastr.error("Instructions cannot be empty   !!");
			        	return;
			        }
				        
				   
				    scheduleData.status = "IN ACTIVE";
			       scheduleData.approvalStatus = "MODIFIED";
			       scheduleData.feeSettings = String(selectedConfigArray);
			     	var scheduleFormDataJson = scheduleData;
					
	          var msg = {
						 title : "Exam Schedule",
						 msg : "Do you want to update this exam schedule?"
					}
			   ConfirmDialog(msg, "SAVE").then(function(response) {
								
						updateRevaluationSchedule(scheduleFormDataJson);
										
				}, function(error) {
						
					toastr.error("Exam Schedule updation cancelled !!");
						
				});
	      
	   });
	    
		
		function updateRevaluationSchedule(scheduleFormDataJson)
		{
			
	               				
				    $.ajax(
			   		{
			   			"url":BASE_URL+"revaluation/update-schedule",
			   			"method":"POST",
			   			 data:scheduleFormDataJson,
			   			success:function(data){
		   			
			   			 // showMessage("Schedule created Successfully");
			   			 toastr.success("Schedule updated Successfully");
			   			  
			   			  //reset  	
			   			  $("#formExamSchedule")[0].reset(); 
			   		      $("#editRevaluation").hide();
			   			
			   		
			   		$('#tblRevaluation').DataTable().ajax.reload();
				   			
			   			},
			   			
						error:function(err)
				   		{
				   			if (err.status == 409) {
	                             
	                             toastr.error("Schedule already exists for the given program, batch and semester !!");
	                            }
	                            else
				   			toastr.error("Saving Exam Schedule failed !!");
				   			 			
				   		}
			   		});	
		 }	
});
 var ConfirmDialog = function (data,type){

 var TYPE;
 var ICON ;
 var BTN_CLASS;

	 if ( type == 'SAVE'){
		 TYPE = 'green';
		 ICON =  'fa fa-save';
		 BTN_CLASS = 'btn-success';
	 }
	 else if ( type == 'DELETE'){
		 TYPE = 'red';
		 ICON =  'fa fa-trash';
		 BTN_CLASS = 'btn-danger';	 
	 }
	 else if ( type == 'APPROVE'){
		 TYPE = 'red';
		 ICON =  'fa fa-thumbs-up';
		 BTN_CLASS = 'btn-danger';	 
	 }
	 else
	 {
		 TYPE = 'red';
		 ICON =  'fa fa-warning';
		 BTN_CLASS = 'btn-warning';	
	 }
	 var DialogPromise = function (resolve, reject) {
	    
	     $.confirm({
	        title: data.title,
	        content:data.msg,
	        closeIcon : true,
	        type: TYPE,
	        icon: ICON,
	        offsetTop: 40,	      
	        bgOpacity :'0.7',
	        buttons: {  
	            ok: {
	                text: "<b> Yes </b>",	            
	                keys: ['enter'],
	                action: function(){	                    
	                     resolve(true); 	                    
	                }
	            },
	            no: function(){
	              text: "<b> No </b>",	                  
	                    reject(false); 
	            }
	        }
     });    
    
   };    
    return  new  Promise (DialogPromise);
 }
    
</script>
