   <!-- Main content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">          
          <!-- /.col-md-12 -->
          <div class="col-lg-12"> 				
				<div class="card card-info card-outline">
				  <div class="card-header ">
					<h5 class="m-0 card-title">Certificate Request</h5>				
				  </div>
				
					  <div class="card-body">	
						<div class="alert alert-danger alert-dismissible fade show" role="alert" id="err_alert" style="display:none;">
						  <strong id="err_title">Error !</strong> <span id="err_message"></span>
						  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						  </button>
						</div>						  
						<div class="row">
							<div class="col-md-6">
								<div class="row">						
									<div class="col-md-6">
										<div class="form-group">
										   <label for="certtype">Certificate Type</label>
										   <select class="form-control" id="certType" name="certType" required>
												  <option selected>--Select--</option>								 						 
											</select>
										</div>
										
									</div>
									<div class="col-md-6">
										<div class="form-group">
										   <label for="cert">Certificate</label>
										   <select class="form-control" id="cert" name="cert" required>
												  <option selected>--Select--</option>								 						 
											</select>
										</div>
									</div>	
									
								</div>
								<div  id="transcriptDiv">
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="certificateNo">No. of copies required</label>
											   <input type="number" class="form-control" id="certificatecount" name="certificatecount" placeholder="Enter No." min="1" max="5" required/>
											</div>
										</div>
										
									</div>
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="purpose">Purpose</label>
											   <textarea class="form-control" rows="3" id="purpose" name="purpose" placeholder="Enter ..." required></textarea>
											</div>
										</div>
									</div>
								</div>
								<div  id="migrationDiv">
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="uploadCert">No Due Certificate issued</label>
											   <div>
												<input id="check" name="check" type="checkbox" name="my-checkbox" data-on-text="Yes"   data-off-text="No" checked data-bootstrap-switch data-off-color="danger" data-on-color="success">
											   </div>
											</div>
										</div>					
									</div>
									<div class="row" id="certNo">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="certID">No Due Certificate No</label>
											   <input type="text" class="form-control" id="duecertificateno" name="duecertificateno" rows="3" placeholder="Enter ..." required/>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="purpose">Purpose</label>
											   <textarea class="form-control" id="noduepurpose" name="noduepurpose" rows="3" placeholder="Enter ..." required></textarea>
											</div>
										</div>
									</div>
								</div>
								<div  id="duplicateDiv">
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="certificateNoOrg">Original Certificate No</label>
											   <input type="text" class="form-control" id="originalcertificateno" name="originalcertificateno" placeholder="Enter No." min="1" max="5" required/>
											</div>
										</div>						
									</div>
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="affidavit">Affidavit<span class="text-red">*</span></label>
											   <div class="input-group">
												  <div class="custom-file">
													 <input type="file" class="custom-file-input" accept="application/pdf"   id="affidavitFile" required>
													<label class="custom-file-label" for="customFile">Choose file</label>
												
													
												  </div>
												 <!--  <div class="input-group-append">
													<span class="input-group-text" id="">Upload</span>
												  </div> -->
												</div>
											</div>
										</div>						
									</div>
								
									<div class="row">
										<div class="col-md-12">
											<div class="form-group">
											   <label for="purpose">Purpose</label>
											   <textarea id="duplicatePurpose" class="form-control" rows="3" placeholder="Enter reason for request"  required></textarea>
											</div>
										</div>
									</div>
								</div>				
							</div>				
						</div>			  
						<button  class="btn btn-sm btn-secondary" id="previewBtn">Request Format Preview </button>				
					  </div>
				</div>       
				 
				<!-- /Preview Certificate -->
				<div class="row">
					<div class="col-md-12">
						  <div class="collapse" id="collapseExample">
				<div class="row" id="previewCertificate">
				  <div class="col-lg-12"> 
					<!-- /Certificate block -->
					<div class="invoice p-3 mb-3">
						<div class="tab-content">
						  <div class="tab-pane active" id="activity">		
							<div class="post">
								<div class="user-block text-center">
									<img class="img-circle img-bordered-sm" src="certificate-management_proxy/certificates/images/nuals.jpg" alt="user image" style="width:70px;height:70px;">
									<span class="username text-center">
									  <h3>The National University of Advanced Legal Studies</h3>
									</span>
									<h6 id="applnType" style="font-weight:600"></h6>
									<hr/>
								</div>			  
							
								<form class="form-horizontal pt-5" id="requestCertificate">     
								  <dl class="row pl-5">
									  <dt class="col-sm-4" >Name</dt>
									  <dd class="col-sm-8" id="student_name"></dd>
									  <dt class="col-sm-4">Gender</dt>
									  <dd class="col-sm-8" id="student_gender"></dd>	
									   <dt class="col-sm-4">Register No.</dt>
									  <dd class="col-sm-8" id="student_reg_no"></dd>	
									  <dt class="col-sm-4">Roll No</dt>
									  <dd class="col-sm-8" id="student_roll_no"></dd>									 
									  <dt class="col-sm-4">Program</dt>
									  <dd class="col-sm-8" id="program_name"></dd>	
									  <dt class="col-sm-4">Batch</dt>
									  <dd class="col-sm-8" id="batch_name"> </dd>	
									  <dt class="col-sm-4">Semester</dt>
									  <dd class="col-sm-8" id="semester"></dd>	
									  <dt class="col-sm-4">Division</dt>
									  <dd class="col-sm-8" id="division"></dd>
									  <!-- Duplicate -->									  	
									  <dt class="col-sm-4" id="label_duplicate_org_no" >Original Certificate No</dt>
									  <dd class="col-sm-8" id="duplicate_org_no">N.A</dd>	
									  <dt class="col-sm-4" id="label_isAffidavit"> Affidavit attached</dt>
									  <dd class="col-sm-8" id="isAffidavit">N.A</dd>
									  <!-- Transcript-->
									  <dt class="col-sm-4" id="label_transcript_copy">No. of copies required</dt>
									  <dd class="col-sm-8" id="transcript_copy">N.A</dd>
									  <!-- Migration-->
									  <dt class="col-sm-4"  id="label_noduenumber">No Due Certificate Number</dt>
									  <dd class="col-sm-8" id="noduenumber">N.A</dd>
									  	
									  <dt class="col-sm-4" id="label_interuniversity">Details of interuniversity transfer</dt>
									  <dd class="col-sm-8" id="interuniversity">N.A</dd>	
									  <!-- Common -->
									  <dt class="col-sm-4" id="label_purpose_certificate">Purpose of certificate request</dt>
									  <dd class="col-sm-8" id="purpose_certificate">N.A</dd>	
									  <dt class="col-sm-4">Fee Amount</dt>
									  <dd class="col-sm-8" > <span class="right badge badge-danger" id="fee"></span></dd>								  
									</dl>
								  
								  <div class="form-group row pt-5">
									<div class="col-sm-10">
									  <div class="checkbox">
										<label>
										  <input type="checkbox" id="decleration" required> Particulars furnished above are true and correct to the best of my knowledge and belief.
										</label>
									  </div>
									</div>
								  </div>
								  <div class="form-group row">
									<div class="col-sm-10">
									  <button type="submit" class="btn btn-danger">Send Request</button>
									</div>
								  </div>
								</form>			
							</div>                  
						  </div>                
						</div> 		
					</div>
					<!-- /Certificate block -->	
				  </div>
				</div>
				</div>
				</div>
				</div>
				 <!-- /Preview Certificate -->
				</div>
			</div>
		</div>
	</div>
	

<script>
//global variables and fns
	
	/* base url for exam management */
	//var BASE_URL = "certificate-management/certificate-management/api/v1/academics/certificate-management/";
	var BASE_URL = "/certificate-management/api/v1/academics/certificate-management/";
	var BASE_MINIO = "/filerepo_public/minioFiles/nuals"; 
	loadCertMappings();
	/* CERTIFICATE TYPES */
	var ORIGINAL_TYPE = 1388;
	var DUPLICATE_TYPE = 1389;
	var MIGRATION = 1400;
	var TRANSCRIPT = 1399;
	var DEGREE = 1397;
	var PROVISIONAL = 1398;
	var NO_DUES = 1655;
	var TRANSFER = 1401;
	var CONDUCT = 2166; //need to check
	var ATTENDANCE = 2168 ; //need to check
	var CONSOLIDATED_MARK_SHEET = 2170;//need to check
	var studentAdmissionDateTime;
	
	var certMap = new Map();
	
	/* fn to convert form data to json */
	$.fn.serializeObject = function()
	{
	    var o = {};
	    var a = this.serializeArray();
	    $.each(a, function() {
	        if (o[this.name] !== undefined) {
	            if (!o[this.name].push) {
	                o[this.name] = [o[this.name]];
	            }
	            o[this.name].push(this.value || '');
	        } else {
	            o[this.name] = this.value || '';
	        }
	    });
	    return o;
	 };

 
 	$('.datepicker').datepicker({
	    format: 'yyyy-mm-dd',							   
		autoclose:true,
		clearBtn:true,
		pickerPosition: "bottom-left"
	});  
	
	$('.datepicker-month-year').datepicker({
	    format: 'M-yyyy',	
	    startView: "months", 
        minViewMode: "months",						   
		autoclose:true,
		clearBtn:true
	});
	
	
	function loadCertMappings()
	{
		$.ajax({
			   type: "GET",
			   url:  BASE_URL + "getCertificateMapping",
			   headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json'
			   },		   
			   success: function(result)
			   {
				  var data = result.data;
				  
				  data.forEach(element => {
					  console.log(element);
					  if(element.mappedId == null){
						//  alert("Failed to Map "+element.certName +" certificates.Kindly contact Admin");
alert(" error in certificate mapping");
						  }
					  else 
				    certMap.set(element.certName,element.mappedId);
				  });
				 //  console.log(certMap.get('ORIGINAL_TYPE'));
				 // for (const [key, value] of certMap.entries()) {
				 //	  console.log(key, value);
				 //	}
			   }
			 });
		
	}
	function openCertificates(certificateurl){
		  window.open(BASE_MINIO+"/"+certificateurl, '_blank');
			/*$.ajax({
				   type: "GET",
				   url:  BASE_URL + "getAffidavitCertificate/"+certificateId,
				   headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				   },		   
				   success: function(result)
				   {
					  console.log(result);
					  window.open(result.DownloadLink, '_blank');
					// $('#affidavitUrl').attr("href",result.DownloadLink);
					 
				   }
				 });*/
		
	}
	
	
	

         
   function getStudentInfo()
	{
	   var studentData = {};       
	    $.ajax({
	   		url: "/students/getStudentsDetails-self-V3",
	   		method: 'GET',
	   		async:false,
	   		//data:{"userCodes":studentId},
	   		success: function(data)
	   		{
	   			var studentId;
	   		  studentData = data;
	   		  console.log(data);	 
	   		  console.log("cjheck 1")
	   		  console.log(data);
	   		  for(let key in data)
	   			{
	   			studentId=key;  
	   			}
	   		 // console.log(studentId)
	   		  setStudentInfo(data,studentId);	   		  
	   		  return data;
	   		  	   			
	   		},
	   		error:function(err)
	   		{
	   		 alert("Failed to load student details");
	   		}
	   	});
	   	
	   	return studentData; 
	 }
	 
	 
	 /**
    *  set the student details
    **/
         
   function setStudentInfo(data,studentId)
	{
	  console.log("cjheck 1")
	  console.log(data);
	  //console.log(studentId)
	  var studentDetails = data[studentId];
	  console.log( studentDetails);
	  loggedStudentProgramId = studentDetails.programCode;
 		//alert(programId);
 		
	  $("#student_reg_no").text(studentDetails.regNo ? studentDetails.regNo : "----");
      $("#student_name").text(studentDetails.studentName);
      $("#student_gender").text(studentDetails.studentPersonalGender);
      $("#student_code").text(studentDetails.studentCode);
      $("#program_name").text(studentDetails.programName);
      $("#batch_name").text(studentDetails.batchName);
      $("#semester").text(studentDetails.semester);
      $("#division").text(studentDetails.division ? studentDetails.division: "-----")
      $("#student_roll_no").text(studentDetails.rollNo ? studentDetails.rollNo:"-----");
     
	}

   
   function loadDataOnPreview(data)
	{
		console.log("Data :: "+JSON.stringify(data));
		console.log(data.purpose);
		
		
	   if(data.originalNo)
		   {
		   $('#duplicate_org_no').show();
		   $('#label_duplicate_org_no').show();
		   $('#duplicate_org_no').text(data.originalNo);
		   }
	   else{
		   $('#duplicate_org_no').hide();
		   $('#label_duplicate_org_no').hide();
	   }
	 
	   if(data.isAffidavit==true && data.affidavit!=null)
		   {
		   $('#isAffidavit').text('Yes');
		   $('#isAffidavit').show();
		   $('#label_isAffidavit').show();
		   $('.AffidavitLink').show();
		   }
		 
	   else{
		 
		   $('#isAffidavit').hide();
		   $('#label_isAffidavit').hide();
		   $('.AffidavitLink').hide();
	   }
	  
	   if(parseInt(data.noCopies)>0)
		   {
			  $('#transcript_copy').show();
			  $('#label_transcript_copy').show();
			  $('#transcript_copy').text(data.noCopies);
		   }
	   else{
		  $('#transcript_copy').hide();
		  $('#label_transcript_copy').hide();
	   }
	  
	   if(data.remarks)
		   {
		   $('#noduenumber').text(data.remarks);
		   $('#noduenumber').show();
		   $('#label_noduenumber').show();
		   }		
	   else{
		   $('#noduenumber').hide();
		   $('#label_noduenumber').hide();
	   }
	  
	   if(data.nameId == TRANSFER || data.nameId == MIGRATION)
		   {
		   loadInterUniversityData(data.studentId);
		   $('#interuniversity').show();
		   $('#label_interuniversity').show();
		   
		   }
	   else
		   {
		   $('#interuniversity').hide();
		   $('#label_interuniversity').hide();
		   
		   }
	  
	   if(data.purpose)
		   {
		   $('#purpose_certificate').text(data.purpose);
		   $('#purpose_certificate').show();
		   $('#label_purpose_certificate').show();
		   }
		
	   else{
		   $('#purpose_certificate').hide();
		   $('#label_purpose_certificate').hide();
	   }
		//$('#fee').text(data.paymentsAmount?data.paymentsAmount:0);//TODO Add Fee details
		$('#fee').text(data.paymentsAmount?data.paymentsAmount+" Rs/-":"0 Rs/-");
		$('#applnType').text(data.name+"("+data.type+")");
		$('#collapseExample').show();
		$('html, body').animate({
		        scrollTop: $("#previewCertificate").offset().top
		}, 1000);
		
	}
	/**
	* To load inter university details of loggedin student
	*/
	 function loadInterUniversityData(loggedInStudentId)
	 {
	    
	      $.ajax({
		         url: "/students/getStudentDetails",
		         data:{"studentAdmissionUserCode":loggedInStudentId },
				 success: function(data)
		           {
					 console.log(data);
					studentAdmissionDateTime = data.sa.studentAdmissionDateTime;
					if(data.sa.studentAdmissionInterUniversity){
						
						$('#interuniversity').text(
						 	"  Inter-University Admission No -- "+data.sa.studentAdmissionInterUniversityAdmissionNo +
						    "  , ProgramName -- "+data.sa.studentAdmissionInterUniversityOldProgramName +
							"  , RollNo -- " +data.sa.studentAdmissionInterUniversityOldRollNo +
							"  , University -- " + data.sa.studentAdmissionInterUniversityOldUniversity +
							"  , Semesters completed -- " + data.sa.studentAdmissionInterUniversitySemestersCompleted 					
						);
						
						
					  
						
					}
					else{
						
						$('#interuniversity').text("NO");
					}
					
		           }
		         });
	 }
	 
   
    /**
   * Fee Settings
   */
   
   var studentListWithData=new Array();
   var studentCodeList=new Array();
   
   
	function loadData(url)
	{
		let dataWithPayment=[];
		$.ajax(
		{
			url:url,
			async:false,
			success:function(data)
			{
			studentListWithData=data.data;
			console.log(studentListWithData);
			if(studentListWithData.length>0){
			  var studfeeidmapArray=generateFeeIdenMapArray(studentListWithData);
			  console.log(studfeeidmapArray);
			  dataWithPayment = getFeeOrderStatus(studfeeidmapArray);
			}
		}
	})
	
	return dataWithPayment;
  }
	
 function generateFeeIdenMapArray(data)
	{
		var mapArray=new Array();
		for(let i=0;i<data.length;i++)
		{
			var map={};
			var studCode=data[i]['studentId'];
			map['feeOrderStudent']=studCode;//maintain the same key feeOrderStudent in map
			map['feeOrderIdentity']=data[i]['orderId'];//maintain the same key feeOrderIdentity in map
			mapArray.push(map);
			}
			return mapArray;
	}

 function addTostudentListWithData(data)
	{
	 console.log("Inside addtistudentlistwithdaTA");
	 	console.log(data);
		for(let i=0;i<studentListWithData.length;i++)
		{
		for(let j=0;j<data.length;j++)
		{
		//if(String(studentListWithData[i]['studentId'])==data[j]['feeOrderStudentCode'])
		if(String(studentListWithData[i]['orderId'])==data[j]['feeOrderId'])
		{
		studentListWithData[i]['feeOrderStatusValue']=data[j]['feeOrderStatusValue'];
		}
		if(studentListWithData[i]['orderId'] == null)
		{
			studentListWithData[i]['feeOrderStatusValue'] = "-";  
		}
		
		}
	}
	
	}
	
	
 function getFeeOrderStatus(datatosend)
	{
		console.log("calling getFeeOrderStatus function")
		$.ajax(
		{
			   url:'/fees/getManyFeeOrderStatusByFeeIdentifierAndAccount',
			   data:{'feeOrderStudents':datatosend},
			   method:"post",
			   async:false,
			   success:function(data)
			   {
					console.log(data); 
					if(data.length>0)
					{
					addTostudentListWithData(data);
					//loadDatatable(studentListWithData);
					//return studentListWithData;
					}
	           },
		    error:function(err)
				{
				showMessage(err);
				}
		});
		return studentListWithData;
}


 var ConfirmDialog = function (data,type){

 var TYPE;
 var ICON ;
 var BTN_CLASS;

	 if ( type == 'SAVE'){
		 TYPE = 'green';
		 ICON =  'fa fa-save';
		 BTN_CLASS = 'btn-success';
	 }
	 else if ( type == 'DELETE'){
		 TYPE = 'red';
		 ICON =  'fa fa-trash';
		 BTN_CLASS = 'btn-danger';	 
	 }
	 else
	 {
		 TYPE = 'orange';
		 ICON =  'fa fa-warning';
		 BTN_CLASS = 'btn-warning';	
	 }
	 var DialogPromise = function (resolve, reject) {
	    
	     $.confirm({
	        title: data.title,
	        content:data.msg,
	        closeIcon : true,
	        type: TYPE,
	        icon: ICON,
	        offsetTop: 40,	      
	        bgOpacity :'0.7',
	        buttons: {  
	            ok: {
	                text: "<b> Yes </b>",	            
	                keys: ['enter'],
	                action: function(){	                    
	                     resolve(true); 	                    
	                }
	            },
	            no: function(){
	              text: "<b> No </b>",	                  
	                    reject(false); 
	            }
	        }
     });    
    
   };    
    return  new  Promise (DialogPromise);
 }
$(document)
		.ready(
				function() {

					$('#transcriptDiv').hide();
					$('#migrationDiv').hide();
					$('#duplicateDiv').hide();
					$('#collapseExample').hide();
					$('#err_alert').hide();
					/*$("input[data-bootstrap-switch]").each(
							function() {
								$(this).bootstrapSwitch('state',
										$(this).prop('checked'));
							});*/
					//bsCustomFileInput.init();

					var certificateRequest = {};
					var errmsg = "";
					// var programId = 0; // TO -do bind
					var feeAmount = 0;
					var studentInfo = {};					
					getCertificateType();
					//var loggedInStudentId = $("#userinfolabel1").val();//$("#usercode").val();
					var studentInfo = getStudentInfo();
					//var student = studentInfo[loggedInStudentId];
					/**
					 * To list the Certificate Types
					 */

					function getCertificateType() {

						$
								.ajax({
									url : '/fees/getCertificateTypes',
									method : 'GET',
									success : function(data) {
										setUpDropDown("certType", data,
												"sfsFeeHeadGroupId",
												"sfsFeeHeadGroupName");

									},
									error : function(err) {
										toastr
												.error("Failed to load Certificate Types");
									}
								});
					}

					/**
					 * To list the Certificate Names
					 */
					function getCertificateNames(type) {

						$.ajax({
							url : '/fees/getCertificatesByCertTypeID',
							method : 'GET',
							data : {
								"groupId" : type
							},
							success : function(data) {
								setUpDropDown("cert", data, "sfsFeeHeadId",
										"sfsFeeHeadName");

							},
							error : function(err) {
								alert("Failed to load Certificates");
							}
						});
					}

					/**
					 * Get Fee amount for the given certificate
					 */
					function getCertificateFee(certificateId, programId) {
						var feeAmount = 0;

						$
								.ajax({
									url : '/fees/getFeeDetailsByCertificateAndCertificateType',
									method : 'GET',
									async : false,
									data : {
										"feeHeadId" : certificateId,
										"programId" : programId
									},
									success : function(data) {
										feeAmount = data.feeAmount;
										return feeAmount;

									},
									error : function(err) {
										toastr
												.error("Failed to load Fee details");
									}
								});
						return feeAmount;

					}

					/**
					 * check for the select event of certificate type dropdown
					 * and populate certificate types based on the selection
					 * "Original" or "Duplicate" If the selection is duplicate
					 * division for entering details of duplicate certificate
					 * was visible
					 */

					$("#certType").unbind().bind('change',
							function() {
								// Hide Preview Division and Empty post json
								$('#collapseExample').hide();
								resetForm();
								certificateRequest = {};

								getCertificateNames($(
										"#certType option:selected").val());

								var certificate = parseInt(this.value);
								certificateRequest.type = $(this).find(
										'option:selected').text();
								certificateRequest.typeId = certificate;

								//if (certificate === ORIGINAL_TYPE)// Original
							    if (certificate === certMap.get('ORIGINAL_TYPE'))// Original
								// Certificates
								{
									$("#cert option").remove();

									$('#duplicateDiv').hide();
								}
								/*
								 * else if(certificate=== DUPLICATE_TYPE
								 * )//Duplicate Certificates { $("#cert
								 * option").remove();
								 * 
								 * $('#duplicateDiv').show();
								 * $('#transcriptDiv').hide();
								 * $('#migrationDiv').hide(); }
								 */

							})
					/**
					 * check for the select event of certificate dropdown to
					 * show/hide transcript and migration details
					 */
					$("#cert").unbind().bind('change',
									function() {
										// Hide Preview Division and Empty post
										// json
										$('#collapseExample').hide();

										resetForm();
										var certificateType = parseInt(this.value);
										feeAmount = getCertificateFee(
												certificateType,
												loggedStudentProgramId);

										certificateRequest.name = $(this).find(
												'option:selected').text();
										certificateRequest.nameId = certificateType;

										if (certificateType === certMap.get('TRANSCRIPT')) // Transcription
										// Id
										{
											$('#transcriptDiv').show();
											$('#migrationDiv').hide();

										} else if (certificateType === certMap.get('MIGRATION')) // Migration
										// Id
										{
										
											$('#migrationDiv').show();
											$('#transcriptDiv').hide();
										} else if (parseInt($(
												"#certType option:selected")
												.val()) === certMap.get('DUPLICATE_TYPE')) {
											$('#duplicateDiv').show();
										} else {
											$('#transcriptDiv').hide();
											$('#migrationDiv').hide();
										}
									})
					/**
					 * Preview Button click event to show sample application
					 * format
					 */
					$("#previewBtn").click(function() {
						 
							
							var isError = checkErrors();
							if (isError) {
								$('#err_message').text(errmsg);
								$('#err_alert').show();
							} else {
								var isRequested = isRequestGenerated(certificateRequest.nameId,certificateRequest.typeId);
								console.log(isRequested)
								
								if (isRequested == null) {
									certificateRequest.paymentsAmount = feeAmount ? feeAmount	: 0;
									certificateRequest.studentId = $("#usercode").val();
									loadDataOnPreview(certificateRequest);
									$('#err_alert').hide();
									$('#collapseExample').show();
									console.log(certificateRequest);
								} else {
									alert("Certificate Already Requested");
								}
							}

					})

					function checkErrors() {
						var isValid = false;
						certificateRequest.isAffidavit = false;// TODO want to
						// change after
						// fileupload
						if (certificateRequest.typeId === undefined
								|| certificateRequest.nameId === undefined) {
							isValid = true;
							errmsg = "Certificate & Type are required";

						} else {

							if (certificateRequest.typeId === certMap.get('DUPLICATE_TYPE'))// Duplicate
							{

								if ($('#originalcertificateno').val().length === 0
										|| $('#duplicatePurpose').val().length === 0
										|| $('#affidavitFile').get(0).files.length === 0) {
									isValid = true;
									errmsg = "Original Certificate No. , Affidavit & Purpose required";
								} else {
									certificateRequest.originalNo = $(
											'#originalcertificateno').val();
									certificateRequest.isAffidavit = true;// TODO
									// change
									// status
									// to
									// true
									// after
									// fileupload
									certificateRequest.purpose = $(
											'#duplicatePurpose').val();
								}

							} else { // Original

								if (certificateRequest.nameId === certMap.get('TRANSCRIPT'))// Transcript
								{
									if (!$('#certificatecount').val()) {
										isValid = true;
										errmsg = "No of copies required";
									} else {
										certificateRequest.noCopies = parseInt($(
												'#certificatecount').val());
										certificateRequest.purpose = $(
												'#purpose').val();
									}

								} else if (certificateRequest.nameId === certMap.get('MIGRATION'))// Migration
								{
									// certificateRequest.noDues = true;
									if ((certificateRequest.noDues === true || certificateRequest.noDues === undefined)	&& !$('#duecertificateno').val()) {
										isValid = true;
										errmsg = "No due certificate number required";

									}else if(certificateRequest.noDues === false ){
										isValid = true;
										errmsg = " Kindly request for No due certificate.";
									} else {
										certificateRequest.remarks = $('#duecertificateno').val();
										certificateRequest.purpose = $('#noduepurpose').val();
									}

								} else {
									delete certificateRequest.noCopies;
									delete certificateRequest;
									delete certificateRequest.remarks;
									$('#certificatecount').val('');
									$('#purpose').val('');
									$('#duecertificateno').val('');
									$('#noduepurpose').val('');

								}
							}
						}

						return isValid;
					}

					/**
					 * change event of no due certificate switch
					 */
				/*	$("input[data-bootstrap-switch]").on(
							'switchChange.bootstrapSwitch',
							function(event, state) {
								console.log(state);
								if (state === true) {
									$('#certNo').show();
									certificateRequest.noDues = state;
								} else {
									$('#certNo').hide();
									certificateRequest.noDues = state;
								}

							});*/
					/**
					 * Reset Form
					 */
					function resetForm() {
						// $("#certType").prop("selectedIndex", 0);
						// $("#cert").prop("selectedIndex", 0);
						$("#certificatecount").val('');
						$("#purpose").val('');
						//$("#check").bootstrapSwitch('state', true);
						$("#duecertificateno").val('');
						$("#noduepurpose").val('');
						$("#originalcertificateno").val('');
						$("#exampleInputFile").val('');
						$("#duplicatePurpose").val('');
						$('input[type=checkbox]').prop('checked', false);
						$('#transcriptDiv').hide();
						$('#migrationDiv').hide();
						$('#duplicateDiv').hide();
						$("#affidavitFile").val('');
						$(".custom-file-label").html('');

					}
					// Form submit
					$("#requestCertificate")
							.submit(
									function(e) {
										e.preventDefault();

										var msg = {
											title : "Save",
											msg : " Do you want to proceed with Certificate Request?"
										}
										ConfirmDialog(msg, "SAVE").then(function(response) {

															certificateRequest.declaration = $(
																	"#decleration")
																	.is(
																			":checked") ? true
																	: false;
															// TODO Assign
															// original student
															// id
															certificateRequest.programId = student.programCode;
															certificateRequest.programName = student.programName;
															certificateRequest.semesterId = student.semester;
															certificateRequest.semesterName = student.semester;
															certificateRequest.batchId = student.batchCode;
															certificateRequest.batchName = student.batchName;
															
															certificateRequest.status = "SUBMITTED";
															certificateRequest.approvalStatus = certificateRequest.nameId === 21 ? null
																	: "SUBMITTED";
															certificateRequest.orderId = null;
															if (certificateRequest.paymentsAmount > 0) {
																var timestamp = Number(new Date());
																var today = new Date();
																var orderId = "CERT-"
																		+ certificateRequest.type
																		+ "-"
																		+ certificateRequest.name
																		+ "-"
																		+ $(
																				"#usercode")
																				.val()
																		+ "-"
																		+ timestamp;
																certificateRequest.orderId = orderId;
																// certificateData=
																// JSON.stringify(certificateRequest);
															}

															console
																	.log(JSON
																			.stringify(certificateRequest));
															var file = $('#affidavitFile')[0].files[0];

															if (file != undefined) {
																let formData = new FormData();
																formData
																		.append(
																				'RequestData',
																				JSON
																						.stringify(certificateRequest));
																formData
																		.append(
																				'file',
																				file);
																saveStudentDataFile(
																		formData,
																		certificateRequest.paymentsAmount,
																		certificateRequest.orderId);
															} else {
																certificateData = JSON
																		.stringify(certificateRequest);
																saveStudentData(
																		certificateData,
																		certificateRequest.paymentsAmount,
																		certificateRequest.orderId);
															}

														}, function(error) {

														});

									});

					/**
					 * store certificate details with affidavit attached
					 */
					function saveStudentDataFile(formData, amount, order_id) {

						$
								.ajax({
									type : "POST",
									url : "/certificate-management_proxy/api/v1/academics/certificate-management/certificate-request-file-by-studentid",
									data : formData,
									cache : false,
									processData : false,
									contentType : false,
									success : function(data) {
										certificateNum = 255; // TO-DO
										// showMessage("Certificate request done
										// Successfully !! . Kindly pay the fees
										// at the fee section ");
										console.log(data);
										if (amount > 0)
											debitStudentFee(certificateNum,
													amount, order_id);

										$("#certType").prop("selectedIndex", 0);
										$("#cert").prop("selectedIndex", 0);
										resetForm();
										$('#collapseExample').hide();
										certificateRequest = {};
										$("html, body").animate({
											scrollTop : 0
										}, "slow");
										alert(data.message);
										// debitStudentFee(feeAmount,certificateNum,orderId);

									},
									error : function(data) {
										toastr
												.error("Error occurred. Kindly contact Administrator");
									}
								});

					}

					/**
					 * store certificate details without affidavit
					 */
					function saveStudentData(certificateData, amount, order_id) {

						$
								.ajax({
									type : "POST",
									url : BASE_URL
											+ "certificate-request-by-studentid",

									data : certificateData,
									headers : {
										'Accept' : 'application/json',
										'Content-Type' : 'application/json'
									},
									success : function(data) {
										certificateNum = 255; // TO-DO
										alert(data.message);
										// showMessage("Certificate request done
										// Successfully !! . Kindly pay the fees
										// at the fee section ");
										if (amount > 0)
											debitStudentFee(certificateNum,
													amount, order_id);
										$("#certType").prop("selectedIndex", 0);
										$("#cert").prop("selectedIndex", 0);
										resetForm();
										$('#collapseExample').hide();
										certificateRequest = {};
										$("html, body").animate({
											scrollTop : 0
										}, "slow");

									},
									error : function(data) {
										console.log(data)
										alert(data.message);
									}
								});

					}
					/**
					 * Raise debit against student
					 */
					function debitStudentFee(certificateNum, amount, order_id) {
						var map = {};
						var formData = [];

						map['transactionIdentifierRemarkOrProcess'] = order_id;
						map['transactionIdentifierProcessId'] = $("#cert")
								.val();
						map['transactionAmount'] = amount;
						map['studentUserCode'] = $("#usercode").val();
						formData.push(map);
						console.log(formData);

						$
								.ajax({
									type : "POST",
									url : "/fees/generateFeeDebitsV1-v1",
									data : {
										"transactionWrappers" : formData
									},

									success : function(data) {
										// showMessage("Fee Debit done
										// Successfully !! . Kindly pay the fees
										// at the fee section ");
										toastr
												.success("Kindly pay the fees to process your certificate request !!! ");
										// addPaymentDetails(certificateNum,orderId,feeAmount);
									},
									error : function(data) {
										alert(data.message);
									}
								});

					}

					function addPaymentDetails(certificateNum, orderId,
							feeAmount) {

						$.ajax({
							type : "POST",
							url : BASE_URL + "payment-details",
							data : {
								"certificatesId" : certificateNum,
								"orderId" : orderId,
								"amount" : feeAmount
							},
							success : function(data) {
								// showMessage("Fee Debit done Successfully !! .
								// Kindly pay the fees at the fee section ");

							},
							error : function(err) {
								alert("Failed to add payment details");
							}
						});

					}

					function isRequestGenerated(nameId, typeId) {
						var isRequested;
						$.ajax({
							type : "GET",
							url : BASE_URL + "isCertificateRequested/name/"
									+ nameId + "/type/" + typeId,
							async : false,
							success : function(result) {

								isRequested = result.data;
							},
							error : function(err) {
								alert("Failed to add payment details");
							}
						});
						return isRequested;
					}

				});

/*
 * Note that this is toastr v2.1.3, the "latest" version in url has no more maintenance,
 * please go to https://cdnjs.com/libraries/toastr.js and pick a certain version you want to use,
 * make sure you copy the url from the website since the url may change between versions.
 * */
!function(e){e(["jquery"],function(e){return function(){function t(e,t,n){return g({type:O.error,iconClass:m().iconClasses.error,message:e,optionsOverride:n,title:t})}function n(t,n){return t||(t=m()),v=e("#"+t.containerId),v.length?v:(n&&(v=d(t)),v)}function o(e,t,n){return g({type:O.info,iconClass:m().iconClasses.info,message:e,optionsOverride:n,title:t})}function s(e){C=e}function i(e,t,n){return g({type:O.success,iconClass:m().iconClasses.success,message:e,optionsOverride:n,title:t})}function a(e,t,n){return g({type:O.warning,iconClass:m().iconClasses.warning,message:e,optionsOverride:n,title:t})}function r(e,t){var o=m();v||n(o),u(e,o,t)||l(o)}function c(t){var o=m();return v||n(o),t&&0===e(":focus",t).length?void h(t):void(v.children().length&&v.remove())}function l(t){for(var n=v.children(),o=n.length-1;o>=0;o--)u(e(n[o]),t)}function u(t,n,o){var s=!(!o||!o.force)&&o.force;return!(!t||!s&&0!==e(":focus",t).length)&&(t[n.hideMethod]({duration:n.hideDuration,easing:n.hideEasing,complete:function(){h(t)}}),!0)}function d(t){return v=e("<div/>").attr("id",t.containerId).addClass(t.positionClass),v.appendTo(e(t.target)),v}function p(){return{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!1,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,progressBar:!1,progressClass:"toast-progress",rtl:!1}}function f(e){C&&C(e)}function g(t){function o(e){return null==e&&(e=""),e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){c(),u(),d(),p(),g(),C(),l(),i()}function i(){var e="";switch(t.iconClass){case"toast-success":case"toast-info":e="polite";break;default:e="assertive"}I.attr("aria-live",e)}function a(){E.closeOnHover&&I.hover(H,D),!E.onclick&&E.tapToDismiss&&I.click(b),E.closeButton&&j&&j.click(function(e){e.stopPropagation?e.stopPropagation():void 0!==e.cancelBubble&&e.cancelBubble!==!0&&(e.cancelBubble=!0),E.onCloseClick&&E.onCloseClick(e),b(!0)}),E.onclick&&I.click(function(e){E.onclick(e),b()})}function r(){I.hide(),I[E.showMethod]({duration:E.showDuration,easing:E.showEasing,complete:E.onShown}),E.timeOut>0&&(k=setTimeout(b,E.timeOut),F.maxHideTime=parseFloat(E.timeOut),F.hideEta=(new Date).getTime()+F.maxHideTime,E.progressBar&&(F.intervalId=setInterval(x,10)))}function c(){t.iconClass&&I.addClass(E.toastClass).addClass(y)}function l(){E.newestOnTop?v.prepend(I):v.append(I)}function u(){if(t.title){var e=t.title;E.escapeHtml&&(e=o(t.title)),M.append(e).addClass(E.titleClass),I.append(M)}}function d(){if(t.message){var e=t.message;E.escapeHtml&&(e=o(t.message)),B.append(e).addClass(E.messageClass),I.append(B)}}function p(){E.closeButton&&(j.addClass(E.closeClass).attr("role","button"),I.prepend(j))}function g(){E.progressBar&&(q.addClass(E.progressClass),I.prepend(q))}function C(){E.rtl&&I.addClass("rtl")}function O(e,t){if(e.preventDuplicates){if(t.message===w)return!0;w=t.message}return!1}function b(t){var n=t&&E.closeMethod!==!1?E.closeMethod:E.hideMethod,o=t&&E.closeDuration!==!1?E.closeDuration:E.hideDuration,s=t&&E.closeEasing!==!1?E.closeEasing:E.hideEasing;if(!e(":focus",I).length||t)return clearTimeout(F.intervalId),I[n]({duration:o,easing:s,complete:function(){h(I),clearTimeout(k),E.onHidden&&"hidden"!==P.state&&E.onHidden(),P.state="hidden",P.endTime=new Date,f(P)}})}function D(){(E.timeOut>0||E.extendedTimeOut>0)&&(k=setTimeout(b,E.extendedTimeOut),F.maxHideTime=parseFloat(E.extendedTimeOut),F.hideEta=(new Date).getTime()+F.maxHideTime)}function H(){clearTimeout(k),F.hideEta=0,I.stop(!0,!0)[E.showMethod]({duration:E.showDuration,easing:E.showEasing})}function x(){var e=(F.hideEta-(new Date).getTime())/F.maxHideTime*100;q.width(e+"%")}var E=m(),y=t.iconClass||E.iconClass;if("undefined"!=typeof t.optionsOverride&&(E=e.extend(E,t.optionsOverride),y=t.optionsOverride.iconClass||y),!O(E,t)){T++,v=n(E,!0);var k=null,I=e("<div/>"),M=e("<div/>"),B=e("<div/>"),q=e("<div/>"),j=e(E.closeHtml),F={intervalId:null,hideEta:null,maxHideTime:null},P={toastId:T,state:"visible",startTime:new Date,options:E,map:t};return s(),r(),a(),f(P),E.debug&&console&&console.log(P),I}}function m(){return e.extend({},p(),b.options)}function h(e){v||(v=n()),e.is(":visible")||(e.remove(),e=null,0===v.children().length&&(v.remove(),w=void 0))}var v,C,w,T=0,O={error:"error",info:"info",success:"success",warning:"warning"},b={clear:r,remove:c,error:t,getContainer:n,info:o,options:{},subscribe:s,success:i,version:"2.1.3",warning:a};return b}()})}("function"==typeof define&&define.amd?define:function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):window.toastr=t(window.jQuery)});
//# sourceMappingURL=toastr.js.map

</script> 
	
	
